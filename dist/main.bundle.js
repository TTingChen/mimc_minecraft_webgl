!function(g){function n(n){for(var c,t,r=n[0],e=n[1],I=n[2],C=0,d=[];C<r.length;C++)t=r[C],Object.prototype.hasOwnProperty.call(T,t)&&T[t]&&d.push(T[t][0]),T[t]=0;for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(g[c]=e[c]);for(N&&N(n);d.length;)d.shift()();return h.push.apply(h,I||[]),l()}function l(){for(var g,n=0;n<h.length;n++){for(var l=h[n],c=!0,t=1;t<l.length;t++){var r=l[t];0!==T[r]&&(c=!1)}c&&(h.splice(n--,1),g=p(p.s=l[0]))}return g}var c=window.webpackHotUpdate;window.webpackHotUpdate=function(g,n){!function(g,n){if(!o[g]||!G[g])return;for(var l in G[g]=!1,n)Object.prototype.hasOwnProperty.call(n,l)&&(u[l]=n[l]);0==--X&&0===m&&V()}(g,n),c&&c(g,n)};var t,r=!0,e="9ccedbed519a56fad130",I=1e4,C={},d=[],b=[];function a(g){var n={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:t!==g,active:!0,accept:function(g,l){if(void 0===g)n._selfAccepted=!0;else if("function"==typeof g)n._selfAccepted=g;else if("object"==typeof g)for(var c=0;c<g.length;c++)n._acceptedDependencies[g[c]]=l||function(){};else n._acceptedDependencies[g]=l||function(){}},decline:function(g){if(void 0===g)n._selfDeclined=!0;else if("object"==typeof g)for(var l=0;l<g.length;l++)n._declinedDependencies[g[l]]=!0;else n._declinedDependencies[g]=!0},dispose:function(g){n._disposeHandlers.push(g)},addDisposeHandler:function(g){n._disposeHandlers.push(g)},removeDisposeHandler:function(g){var l=n._disposeHandlers.indexOf(g);l>=0&&n._disposeHandlers.splice(l,1)},check:Z,apply:y,status:function(g){if(!g)return s;B.push(g)},addStatusHandler:function(g){B.push(g)},removeStatusHandler:function(g){var n=B.indexOf(g);n>=0&&B.splice(n,1)},data:C[g]};return t=void 0,n}var B=[],s="idle";function A(g){s=g;for(var n=0;n<B.length;n++)B[n].call(null,g)}var Q,u,F,X=0,m=0,i={},G={},o={};function x(g){return+g+""===g?+g:g}function Z(g){if("idle"!==s)throw new Error("check() is only allowed in idle status");return r=g,A("check"),(n=I,n=n||1e4,new Promise((function(g,l){if("undefined"==typeof XMLHttpRequest)return l(new Error("No browser support"));try{var c=new XMLHttpRequest,t=p.p+""+e+".hot-update.json";c.open("GET",t,!0),c.timeout=n,c.send(null)}catch(g){return l(g)}c.onreadystatechange=function(){if(4===c.readyState)if(0===c.status)l(new Error("Manifest request to "+t+" timed out."));else if(404===c.status)g();else if(200!==c.status&&304!==c.status)l(new Error("Manifest request to "+t+" failed."));else{try{var n=JSON.parse(c.responseText)}catch(g){return void l(g)}g(n)}}}))).then((function(g){if(!g)return A("idle"),null;G={},i={},o=g.c,F=g.h,A("prepare");var n=new Promise((function(g,n){Q={resolve:g,reject:n}}));for(var l in u={},T)U(l);return"prepare"===s&&0===m&&0===X&&V(),n}));var n}function U(g){o[g]?(G[g]=!0,X++,function(g){var n=document.createElement("script");n.charset="utf-8",n.src=p.p+""+g+"."+e+".hot-update.js",document.head.appendChild(n)}(g)):i[g]=!0}function V(){A("ready");var g=Q;if(Q=null,g)if(r)Promise.resolve().then((function(){return y(r)})).then((function(n){g.resolve(n)}),(function(n){g.reject(n)}));else{var n=[];for(var l in u)Object.prototype.hasOwnProperty.call(u,l)&&n.push(x(l));g.resolve(n)}}function y(n){if("ready"!==s)throw new Error("apply() is only allowed in ready status");var l,c,t,r,I;function b(g){for(var n=[g],l={},c=n.map((function(g){return{chain:[g],id:g}}));c.length>0;){var t=c.pop(),e=t.id,I=t.chain;if((r=R[e])&&!r.hot._selfAccepted){if(r.hot._selfDeclined)return{type:"self-declined",chain:I,moduleId:e};if(r.hot._main)return{type:"unaccepted",chain:I,moduleId:e};for(var C=0;C<r.parents.length;C++){var d=r.parents[C],b=R[d];if(b){if(b.hot._declinedDependencies[e])return{type:"declined",chain:I.concat([d]),moduleId:e,parentId:d};-1===n.indexOf(d)&&(b.hot._acceptedDependencies[e]?(l[d]||(l[d]=[]),a(l[d],[e])):(delete l[d],n.push(d),c.push({chain:I.concat([d]),id:d})))}}}}return{type:"accepted",moduleId:g,outdatedModules:n,outdatedDependencies:l}}function a(g,n){for(var l=0;l<n.length;l++){var c=n[l];-1===g.indexOf(c)&&g.push(c)}}n=n||{};var B={},Q=[],X={},m=function(){console.warn("[HMR] unexpected require("+G.moduleId+") to disposed module")};for(var i in u)if(Object.prototype.hasOwnProperty.call(u,i)){var G;I=x(i);var Z=!1,U=!1,V=!1,y="";switch((G=u[i]?b(I):{type:"disposed",moduleId:i}).chain&&(y="\nUpdate propagation: "+G.chain.join(" -> ")),G.type){case"self-declined":n.onDeclined&&n.onDeclined(G),n.ignoreDeclined||(Z=new Error("Aborted because of self decline: "+G.moduleId+y));break;case"declined":n.onDeclined&&n.onDeclined(G),n.ignoreDeclined||(Z=new Error("Aborted because of declined dependency: "+G.moduleId+" in "+G.parentId+y));break;case"unaccepted":n.onUnaccepted&&n.onUnaccepted(G),n.ignoreUnaccepted||(Z=new Error("Aborted because "+I+" is not accepted"+y));break;case"accepted":n.onAccepted&&n.onAccepted(G),U=!0;break;case"disposed":n.onDisposed&&n.onDisposed(G),V=!0;break;default:throw new Error("Unexception type "+G.type)}if(Z)return A("abort"),Promise.reject(Z);if(U)for(I in X[I]=u[I],a(Q,G.outdatedModules),G.outdatedDependencies)Object.prototype.hasOwnProperty.call(G.outdatedDependencies,I)&&(B[I]||(B[I]=[]),a(B[I],G.outdatedDependencies[I]));V&&(a(Q,[G.moduleId]),X[I]=m)}var h,E=[];for(c=0;c<Q.length;c++)I=Q[c],R[I]&&R[I].hot._selfAccepted&&X[I]!==m&&E.push({module:I,errorHandler:R[I].hot._selfAccepted});A("dispose"),Object.keys(o).forEach((function(g){!1===o[g]&&function(g){delete T[g]}(g)}));for(var J,H,N=Q.slice();N.length>0;)if(I=N.pop(),r=R[I]){var W={},D=r.hot._disposeHandlers;for(t=0;t<D.length;t++)(l=D[t])(W);for(C[I]=W,r.hot.active=!1,delete R[I],delete B[I],t=0;t<r.children.length;t++){var w=R[r.children[t]];w&&((h=w.parents.indexOf(I))>=0&&w.parents.splice(h,1))}}for(I in B)if(Object.prototype.hasOwnProperty.call(B,I)&&(r=R[I]))for(H=B[I],t=0;t<H.length;t++)J=H[t],(h=r.children.indexOf(J))>=0&&r.children.splice(h,1);for(I in A("apply"),e=F,X)Object.prototype.hasOwnProperty.call(X,I)&&(g[I]=X[I]);var L=null;for(I in B)if(Object.prototype.hasOwnProperty.call(B,I)&&(r=R[I])){H=B[I];var Y=[];for(c=0;c<H.length;c++)if(J=H[c],l=r.hot._acceptedDependencies[J]){if(-1!==Y.indexOf(l))continue;Y.push(l)}for(c=0;c<Y.length;c++){l=Y[c];try{l(H)}catch(g){n.onErrored&&n.onErrored({type:"accept-errored",moduleId:I,dependencyId:H[c],error:g}),n.ignoreErrored||L||(L=g)}}}for(c=0;c<E.length;c++){var f=E[c];I=f.module,d=[I];try{p(I)}catch(g){if("function"==typeof f.errorHandler)try{f.errorHandler(g)}catch(l){n.onErrored&&n.onErrored({type:"self-accept-error-handler-errored",moduleId:I,error:l,originalError:g}),n.ignoreErrored||L||(L=l),L||(L=g)}else n.onErrored&&n.onErrored({type:"self-accept-errored",moduleId:I,error:g}),n.ignoreErrored||L||(L=g)}}return L?(A("fail"),Promise.reject(L)):(A("idle"),new Promise((function(g){g(Q)})))}var R={},T={0:0},h=[];function p(n){if(R[n])return R[n].exports;var l=R[n]={i:n,l:!1,exports:{},hot:a(n),parents:(b=d,d=[],b),children:[]};return g[n].call(l.exports,l,l.exports,function(g){var n=R[g];if(!n)return p;var l=function(l){return n.hot.active?(R[l]?-1===R[l].parents.indexOf(g)&&R[l].parents.push(g):(d=[g],t=l),-1===n.children.indexOf(l)&&n.children.push(l)):(console.warn("[HMR] unexpected require("+l+") from disposed module "+g),d=[]),p(l)},c=function(g){return{configurable:!0,enumerable:!0,get:function(){return p[g]},set:function(n){p[g]=n}}};for(var r in p)Object.prototype.hasOwnProperty.call(p,r)&&"e"!==r&&"t"!==r&&Object.defineProperty(l,r,c(r));return l.e=function(g){return"ready"===s&&A("prepare"),m++,p.e(g).then(n,(function(g){throw n(),g}));function n(){m--,"prepare"===s&&(i[g]||U(g),0===m&&0===X&&V())}},l.t=function(g,n){return 1&n&&(g=l(g)),p.t(g,-2&n)},l}(n)),l.l=!0,l.exports}p.m=g,p.c=R,p.d=function(g,n,l){p.o(g,n)||Object.defineProperty(g,n,{enumerable:!0,get:l})},p.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},p.t=function(g,n){if(1&n&&(g=p(g)),8&n)return g;if(4&n&&"object"==typeof g&&g&&g.__esModule)return g;var l=Object.create(null);if(p.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:g}),2&n&&"string"!=typeof g)for(var c in g)p.d(l,c,function(n){return g[n]}.bind(null,c));return l},p.n=function(g){var n=g&&g.__esModule?function(){return g.default}:function(){return g};return p.d(n,"a",n),n},p.o=function(g,n){return Object.prototype.hasOwnProperty.call(g,n)},p.p="",p.h=function(){return e};var E=window.webpackJsonp=window.webpackJsonp||[],J=E.push.bind(E);E.push=n,E=E.slice();for(var H=0;H<E.length;H++)n(E[H]);var N=J;h.push([16,1]),l()}({16:function(g,n,l){l(17),l(41),g.exports=l(43)},40:function(module,exports,__webpack_require__){eval('var map = {\n\t"./log": 2\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error("Cannot find module \'" + req + "\'");\n\t\te.code = \'MODULE_NOT_FOUND\';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 40;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vbm9kZV9tb2R1bGVzL3dlYnBhY2svaG90IHN5bmMgbm9ucmVjdXJzaXZlIF5cXC5cXC9sb2ckPzFkZDUiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIG1hcCA9IHtcblx0XCIuL2xvZ1wiOiAyXG59O1xuXG5cbmZ1bmN0aW9uIHdlYnBhY2tDb250ZXh0KHJlcSkge1xuXHR2YXIgaWQgPSB3ZWJwYWNrQ29udGV4dFJlc29sdmUocmVxKTtcblx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oaWQpO1xufVxuZnVuY3Rpb24gd2VicGFja0NvbnRleHRSZXNvbHZlKHJlcSkge1xuXHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKG1hcCwgcmVxKSkge1xuXHRcdHZhciBlID0gbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIiArIHJlcSArIFwiJ1wiKTtcblx0XHRlLmNvZGUgPSAnTU9EVUxFX05PVF9GT1VORCc7XG5cdFx0dGhyb3cgZTtcblx0fVxuXHRyZXR1cm4gbWFwW3JlcV07XG59XG53ZWJwYWNrQ29udGV4dC5rZXlzID0gZnVuY3Rpb24gd2VicGFja0NvbnRleHRLZXlzKCkge1xuXHRyZXR1cm4gT2JqZWN0LmtleXMobWFwKTtcbn07XG53ZWJwYWNrQ29udGV4dC5yZXNvbHZlID0gd2VicGFja0NvbnRleHRSZXNvbHZlO1xubW9kdWxlLmV4cG9ydHMgPSB3ZWJwYWNrQ29udGV4dDtcbndlYnBhY2tDb250ZXh0LmlkID0gNDA7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///40\n')},43:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ../node_modules/gl-matrix/esm/index.js + 4 modules\nvar esm = __webpack_require__(0);\n\n// EXTERNAL MODULE: ../node_modules/stats-js/build/stats.min.js\nvar stats_min = __webpack_require__(8);\n\n// EXTERNAL MODULE: ../node_modules/dat.gui/build/dat.gui.module.js\nvar dat_gui_module = __webpack_require__(9);\n\n// CONCATENATED MODULE: ./perlin.js\nclass Perlin{\r\n    constructor(){\r\n        this.p =  [ 151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10,\r\n            23, 190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33, 88, 237, 149, 56, 87,\r\n            174, 20, 125, 136, 171, 168, 68, 175, 74, 165, 71, 134, 139, 48, 27, 166, 77, 146, 158, 231, 83, 111, 229, 122, 60, 211,\r\n            133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244, 102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76, 132, 187, 208,\r\n            89, 18, 169, 200, 196, 135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186, 3, 64, 52, 217, 226, 250, 124, 123, 5,\r\n            202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42, 223, 183, 170, 213, 119,\r\n            248, 152, 2, 44, 154, 163, 70, 221, 153, 101, 155, 167, 43, 172, 9, 129, 22, 39, 253, 19, 98, 108, 110, 79, 113, 224, 232,\r\n            178, 185, 112, 104, 218, 246, 97, 228, 251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81, 51, 145, 235, 249,\r\n            14, 239, 107, 49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115, 121, 50, 45, 127, 4, 150, 254, 138, 236, 205,\r\n            93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180 ];\r\n    }\r\n    perlin(x, y, z) {\r\n        let floorX =Math.floor(x), floorY = Math.floor(y), floorZ = Math.floor(z);\r\n\r\n\t\tlet X = floorX & 255, Y = floorY & 255, Z = floorZ & 255;\r\n\r\n\t\tx -= floorX;\r\n\t\ty -= floorY;\r\n\t\tz -= floorZ;\r\n\r\n\t\t//printf("x %f, y= %f, z= %f\\n", x, y, z);\r\n\t\tlet xMinus1 = x - 1, yMinus1 = y - 1, zMinus1 = z - 1;\r\n\r\n\t\tlet u = this.fade(x), v = this.fade(y), w = this.fade(z);\r\n\r\n\t\tlet A = this.p[X] + Y, AA = this.p[A] + Z, AB = this.p[A + 1] + Z, B = this.p[X + 1] + Y, BA = this.p[B] + Z, BB = this.p[B + 1] + Z;\r\n\r\n\t\treturn this.lerp(w, this.lerp(v, this.lerp(u, this.grad(this.p[AA], x, y, z),\r\n\t\t\t\t\t\t\t\t\t\tthis.grad(this.p[BA], xMinus1, y, z)),\r\n\t\t\t\t\t\t\t\tthis.lerp(u, this.grad(this.p[AB], x, yMinus1, z),\r\n\t\t\t\t\t\t\t\t\t\tthis.grad(this.p[BB], xMinus1, yMinus1, z))),\r\n\t\t\t\t\t\tthis.lerp(v, this.lerp(u, this.grad(this.p[AA + 1], x, y, zMinus1),\r\n\t\t\t\t\t\t\t\t\t\tthis.grad(this.p[BA + 1], xMinus1, y, z - 1)),\r\n\t\t\t\t\t\t\t\tthis.lerp(u, this.grad(this.p[AB + 1], x, yMinus1, zMinus1),\r\n\t\t\t\t\t\t\t\t\t\tthis.grad(this.p[BB + 1], xMinus1, yMinus1, zMinus1))));\r\n\r\n    }\r\n    lerp(t,a,b){\r\n        return a + t * (b-a);\r\n    }\r\n    fade(t) {\r\n\r\n        return t * t * t * (t * (t * 6 - 15) + 10);\r\n    \r\n    }\r\n    grad(hash, x, y, z) {\r\n\r\n        let h = hash & 15;\r\n        let u = h < 8 ? x : y, \r\n              v = h < 4 ? y : h == 12 || h == 14 ? x : z;\r\n        return ((h & 1) == 0 ? u : -u) + ((h & 2) == 0 ? v : -v);\r\n    \r\n    }\r\n    noise(x, y, z){\r\n        for (let i = 0; i < 256; i++) {\r\n            this.p[256 + i] = this.p[i];\r\n\r\n        }\r\n        let a = this.perlin(x, y, z);\r\n        //printf("noise: perlin = %f\\n", a);\r\n        return a;\r\n    }\r\n\r\n}\n// CONCATENATED MODULE: ./main.js\n\r\n\r\n\r\n\r\n\r\n// global variable\r\nvar gl = window.WebGL2RenderingContext.prototype; // specify type for code snippet\r\nvar stats = null;\r\nvar gui = null;\r\nvar perlin = null;\r\n\r\nvar global = {\r\n    program: null,\r\n    start: null,\r\n};\r\nvar matrix = {\r\n    m: null,\r\n    v: null,\r\n    p: null,\r\n};\r\nvar uniform = {\r\n    mvp: null,\r\n    m: null,\r\n    eye: null,\r\n    light: null,\r\n    co: null,\r\n    nm: null,\r\n    use: null,\r\n};\r\nvar model = {\r\n    vao: null,\r\n    ctr: null,\r\n    tex: [],\r\n};\r\nvar flag = {\r\n    normal: false,\r\n    shadow: false,\r\n    ssao: false,\r\n};\r\n\r\nvar trackball = {\r\n    x_yaw : null,\r\n    y_pitch :  null,\r\n\tdegree_x : null,\r\n\tdegree_y : null,\r\n\tlfront :null,\r\n    sensitivity : null,\r\n\tspeed : null,\r\n\tcamPos :null,\r\n\tcamFront : null,\r\n\tcamUp : null,\r\n};\r\n\r\nvar keyPress = {\r\n    W: false,\r\n    A: false,\r\n    S: false,\r\n    D: false,\r\n    Z: false,\r\n    X: false,\r\n    on:false,\r\n}\r\n\r\nvar mouse = {\r\n    down:false,\r\n    diff_x:null,\r\n    diff_y:null,\r\n    last_x:null,\r\n    last_y:null,\r\n}\r\nvar skybox = {\r\n    program: null,\r\n    vao: null,\r\n    u_pvm: null,\r\n}\r\nvar land = {\r\n    landProg: null,\r\n    vao:null,\r\n    indexCount:null,\r\n    u_v:null,\r\n    u_p:null,\r\n    u_trans: null,\r\n    u_eyepos: null,\r\n    u_light_pos: null,\r\n    u_shadow_matrix: null,\r\n    u_offset:null,\r\n    trans:null,\r\n    shadow_matrix:null,\r\n    offset:null,\r\n    tex:[],\r\n    data:[],\r\n    u_isN:false,\r\n    u_isSH:false,\r\n    u_isSsao:false,\r\n}\r\nvar depth = {\r\n    program: null,\r\n    u_vp: null,\r\n    u_trans: null,\r\n    u_offset: null,\r\n    fbo: null,\r\n    tex: null,  \r\n};\r\nvar ssao = {\r\n    program: null,\r\n    fbo: null,\r\n    norm_tex: null,   \r\n    depth_tex: null,   \r\n    noise_map: null,   \r\n    u_v: null,\r\n    u_p: null,\r\n    u_trans: null,\r\n    u_offset: null,\r\n};\r\nvar test = {\r\n    program: null,\r\n    fbo: null,\r\n    vao: null,\r\n    u_p: null,\r\n    u_noise_scale: null,\r\n    ao_tex: null,\r\n    kernel_ubo: null,\r\n}\r\nvar light_pos = esm["c" /* vec3 */].fromValues(0, 100, 150);\r\nvar lightvp = esm["a" /* mat4 */].create();\r\nvar depth_size = 4096;\r\nvar worldWidth = 100;\r\nvar worldDepth = 100;\r\nvar worldHalfWidth = worldWidth / 2;\r\nvar worldHalfDepth = worldDepth / 2;\r\nfunction initWebGL() {\r\n    let canvas = document.createElement(\'canvas\');\r\n    canvas.width = window.innerWidth;\r\n    canvas.height = window.innerHeight;\r\n    document.querySelector(\'body\').appendChild(canvas);\r\n\r\n    gl = canvas.getContext(\'webgl2\');\r\n    if (!gl) {\r\n        alert(\'WebGL 2 not available\');\r\n    }\r\n\r\n    // webgl setting\r\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n    gl.clearDepth(1.0);\r\n    gl.enable(gl.DEPTH_TEST);\r\n    // gl.depthFunc(gl.LEQUAL);\r\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n\r\n    // fps\r\n    stats = new stats_min();\r\n    stats.domElement.classList.add(\'navbar\')\r\n    document.body.appendChild(stats.domElement);\r\n\r\n    // gui\r\n    gui = new dat_gui_module["a" /* GUI */]();\r\n    gui.domElement.classList.add(\'navbar\');\r\n    let nmFolder = gui.addFolder(\'Normal\');\r\n    nmFolder.add(flag, \'normal\').onChange((val) => {\r\n        gl.uniform1i(land.u_isN, val);\r\n    });\r\n    nmFolder.add(flag, \'shadow\').onChange((val) => {\r\n        gl.uniform1i(land.u_isSH, val);\r\n    });\r\n    nmFolder.add(flag, \'ssao\').onChange((val) => {\r\n        gl.uniform1i(land.u_isSsao, val);\r\n    });\r\n    nmFolder.open();\r\n\r\n    //perlin\r\n    perlin = new Perlin();\r\n\r\n\r\n    \r\n    //init trackball\r\n    trackball_init(0.001, 0.05);\r\n    \r\n    // matrix\r\n    matrix.m = esm["a" /* mat4 */].create();\r\n    matrix.v = esm["a" /* mat4 */].create();\r\n    matrix.p = esm["a" /* mat4 */].create();\r\n    esm["a" /* mat4 */].lookAt(matrix.v, trackball.camPos, trackball.camFront, trackball.camUp);\r\n\r\n    esm["a" /* mat4 */].perspective(matrix.p, radians(60), gl.drawingBufferWidth / gl.drawingBufferHeight, 0.1, 1000.0);\r\n    \r\n    //init skybox->createshader\r\n\r\n    //init land->createshader\r\n\r\n}\r\n\r\n\r\n\r\nfunction trackball_init(sens, sp){\r\n    trackball.x_yaw = -90.0;\r\n\ttrackball.y_pitch = 0.0;\r\n\ttrackball.degree_x = 0.0;\r\n\ttrackball.degree_y = 0.0;\r\n    trackball.lfront = esm["c" /* vec3 */].create();\r\n    esm["c" /* vec3 */].set(trackball.lfront, 0, 0, 0);\r\n\r\n\ttrackball.sensitivity = sens;\r\n    trackball.speed = sp;\r\n\r\n    trackball.camPos = esm["c" /* vec3 */].create();\r\n    esm["c" /* vec3 */].set(trackball.camPos, 0, 1, 5);\r\n\r\n    trackball.camFront = esm["c" /* vec3 */].create();\r\n    esm["c" /* vec3 */].set(trackball.camFront, 0, 0, 0);\r\n    trackball.camUp = esm["c" /* vec3 */].create();\r\n    esm["c" /* vec3 */].set(trackball.camUp, 0, 1, 0);\r\n\r\n    document.addEventListener( \'mousedown\', onMouseDown );\r\n    document.addEventListener( \'mousemove\', onMouseMove );\r\n    document.addEventListener( \'mouseup\', onMouseUp );\r\n    document.addEventListener( \'keydown\', onKeyDown, false );\r\n    document.addEventListener( \'keyup\', onKeyUp, false );\r\n}\r\n\r\nfunction onMouseDown(e){\r\n    mouse.down = true;\r\n    mouse.last_x = e.clientX;\r\n\tmouse.last_y = e.clientY;\r\n    console.log(\'down\');\r\n}\r\nfunction onMouseMove(e){\r\n    if(mouse.down === true){\r\n        mouse.diff_x = e.clientX  - mouse.last_x;\r\n        mouse.diff_y = mouse.last_y - e.clientY;\r\n        //update view\r\n        trackball_update(\'Tlook\');\r\n    }\r\n}\r\nfunction onMouseUp(e){\r\n    mouse.down = false;\r\n}\r\n\r\nfunction onKeyDown(e){\r\n    keyPress.on = true;\r\n    switch(e.code){\r\n        case \'KeyW\':\r\n            keyPress.W = true;\r\n        break;\r\n        case \'KeyA\':\r\n            keyPress.A = true;\r\n        break;\r\n        case \'KeyS\':\r\n            keyPress.S = true;\r\n        break;\r\n        case \'KeyD\':\r\n            keyPress.D = true;\r\n        break;\r\n        case \'KeyZ\':\r\n            keyPress.Z = true;\r\n        break;\r\n        case \'KeyX\':\r\n            keyPress.X = true;\r\n        break;\r\n        \r\n    }\r\n    \r\n}\r\n\r\nfunction onKeyUp(e){\r\n    console.log(e.code + \' Up\');\r\n    keyPress.on = false;\r\n    switch(e.code){\r\n        case \'KeyW\':\r\n            keyPress.W = false;\r\n        break;\r\n        case \'KeyA\':\r\n            keyPress.A = false;\r\n        break;\r\n        case \'KeyS\':\r\n            keyPress.S = false;\r\n        break;\r\n        case \'KeyD\':\r\n            keyPress.D = false;\r\n        break;\r\n        case \'KeyZ\':\r\n            keyPress.Z = false;\r\n        break;\r\n        case \'KeyX\':\r\n            keyPress.X = false;\r\n        break;\r\n    }\r\n}\r\n\r\nfunction createShader() {\r\n    //init skybox\r\n    skybox_createShader();\r\n    //init depth map\r\n    depthMap_createShader();\r\n    //init land\r\n    land_createShader();\r\n    //init ssao\r\n    ssao_createShader();\r\n    //init test\r\n    test_createShader();\r\n\r\n}\r\n\r\nfunction test_createShader(){\r\n    let vsSrc = document.getElementById(\'test.vs\').innerText.trim();\r\n    let fsSrc = document.getElementById(\'test.fs\').innerText.trim();\r\n\r\n    test.program = create_program(vsSrc, fsSrc);\r\n\r\n    test.u_p = gl.getUniformLocation(test.program, \'ssao_um4p\');\r\n    test.u_noise_scale = gl.getUniformLocation(test.program, "noise_scale");\r\n\r\n    test.fbo = gl.createFramebuffer();\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, test.fbo);\r\n\r\n    test.ao_tex = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, test.ao_tex);\r\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8, window.innerWidth, window.innerHeight);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\r\n    var dep = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, dep);\r\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.DEPTH_COMPONENT32F, window.innerWidth, window.innerHeight);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_FUNC, gl.LEQUAL);\r\n    \r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, test.ao_tex, 0);\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, dep, 0);\r\n    \r\n    test.vao = gl.createVertexArray();\r\n    gl.bindVertexArray(test.vao);\r\n\r\n    test.kernel_ubo = gl.createBuffer();\r\n    gl.bindBuffer(gl.UNIFORM_BUFFER, test.kernel_ubo);\r\n    let kernels = new Float32Array(128);\r\n    let tmp = esm["c" /* vec3 */].create();\r\n    let out = esm["c" /* vec3 */].create();\r\n\tfor (let i = 0; i < 32; i++)\r\n\t{\r\n\t\tesm["c" /* vec3 */].normalize(tmp ,esm["c" /* vec3 */].fromValues(\r\n\t\t\tMath.random() * 2 - 1,\r\n\t\t\tMath.random() * 2 - 1,\r\n\t\t\tMath.random() * 0.85 + 0.15\r\n        ));\r\n        let sca = i / 32;\r\n        sca = 0.1 + 0.9 * sca * sca;\r\n        esm["c" /* vec3 */].mul(out, tmp, esm["c" /* vec3 */].fromValues(sca, sca, sca));\r\n        kernels[4*i] =   tmp[0] * sca;//out[0];\r\n        kernels[4*i+1] = tmp[1] * sca;//out[1];\r\n        kernels[4*i+2] = tmp[2] * sca;//out[2];\r\n        kernels[4*i+3] = 0;\r\n    }\r\n    gl.bufferData(gl.UNIFORM_BUFFER, kernels, gl.STATIC_DRAW);\r\n\r\n    let t0 = gl.getUniformLocation(test.program, \'gDepth_tex\');\r\n    let t1 = gl.getUniformLocation(test.program, \'gNorm_tex\');\r\n    let t2 = gl.getUniformLocation(test.program, \'gNoise\');\r\n\r\n    gl.useProgram(test.program);\r\n    gl.uniform1i(t0, 0);\r\n    gl.uniform1i(t1, 1);\r\n    gl.uniform1i(t2, 2);\r\n\r\n    let blockIdx = gl.getUniformBlockIndex(test.program, "Kernals");\r\n    gl.uniformBlockBinding(test.program, blockIdx, 0);\r\n    \r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n\r\n\r\n}\r\n\r\nfunction ssao_createShader(){\r\n    let vsSrc = document.getElementById(\'ssao.vs\').innerText.trim();\r\n    let fsSrc = document.getElementById(\'ssao.fs\').innerText.trim();\r\n\r\n    ssao.program = create_program(vsSrc, fsSrc);\r\n\r\n    ssao.u_trans = gl.getUniformLocation(ssao.program, \'trans\');\r\n    ssao.u_v = gl.getUniformLocation(ssao.program, \'um4v\');\r\n    ssao.u_p = gl.getUniformLocation(ssao.program, \'um4p\');\r\n    ssao.u_offset = gl.getUniformLocation(ssao.program, \'offset\');\r\n    ssao.fbo = gl.createFramebuffer();\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, ssao.fbo);\r\n    \r\n    ssao.norm_tex = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, ssao.norm_tex);\r\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8, window.innerWidth, window.innerHeight);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n\r\n    ssao.depth_tex = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, ssao.depth_tex);\r\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.DEPTH_COMPONENT32F, window.innerWidth, window.innerHeight);\r\n\r\n    // gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);\r\n\t// gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_FUNC, gl.LEQUAL);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, ssao.norm_tex, 0);\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, ssao.depth_tex, 0);\r\n\r\n    \t// noise map\r\n\tssao.noise_map = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, ssao.noise_map);\r\n\r\n    let noiseData = new Float32Array(48);\r\n    let out = esm["c" /* vec3 */].create();\r\n\tfor (let i = 0; i < 16; i++)\r\n\t{\r\n\t\tesm["c" /* vec3 */].normalize(out ,esm["c" /* vec3 */].fromValues(\r\n\t\t\tMath.random(), // 0.0 ~ 1.0\r\n\t\t\tMath.random(), // 0.0 ~ 1.0\r\n\t\t\t0.0\r\n        ));\r\n        noiseData[3*i] = out[0];\r\n        noiseData[3*i+1] = out[1];\r\n        noiseData[3*i+2] = out[2];\r\n\t}\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB32F, 4, 4, 0, gl.RGB, gl.FLOAT, noiseData);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\r\n\t////\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n}\r\n\r\nfunction depthMap_createShader(){\r\n    let vsSrc = document.getElementById(\'depth.vs\').innerText.trim();\r\n    let fsSrc = document.getElementById(\'depth.fs\').innerText.trim();\r\n\r\n    depth.program = create_program(vsSrc, fsSrc);\r\n    //uniform todo\r\n    depth.u_trans = gl.getUniformLocation(depth.program, \'trans\');\r\n    depth.u_vp = gl.getUniformLocation(depth.program, \'um4vp\');\r\n    depth.u_offset = gl.getUniformLocation(depth.program, \'offset\');\r\n\r\n    //init tex\r\n    depth.fbo = gl.createFramebuffer();\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, depth.fbo);\r\n    depth.tex = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, depth.tex);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.DEPTH_COMPONENT32F, depth_size, depth_size, 0,\r\n        gl.DEPTH_COMPONENT, gl.FLOAT, null);\r\n    \r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_FUNC, gl.LEQUAL);\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, depth.tex, 0);\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n    let range = 150;\r\n    let light_p = esm["a" /* mat4 */].create();\r\n    esm["a" /* mat4 */].ortho(light_p, -range, range, -range, range, 0, 500);\r\n    let light_v = esm["a" /* mat4 */].create();\r\n    esm["a" /* mat4 */].lookAt(light_v, light_pos, esm["c" /* vec3 */].fromValues(0, 0, 0),\r\n        esm["c" /* vec3 */].fromValues(0, 1, 0));\r\n    esm["a" /* mat4 */].multiply(lightvp, light_p, light_v);\r\n\r\n}\r\n\r\n\r\nfunction land_createShader(){\r\n    // get shader string\r\n    let vsSrc = document.getElementById(\'land.vs\').innerText.trim();\r\n    let fsSrc = document.getElementById(\'land.fs\').innerText.trim();\r\n\r\n    land.landProg = create_program(vsSrc, fsSrc);\r\n    //uniform todo\r\n    land.u_v = gl.getUniformLocation(land.landProg, \'um4v\');\r\n    land.u_p = gl.getUniformLocation(land.landProg, \'um4p\');\r\n    land.u_trans = gl.getUniformLocation(land.landProg, \'trans\');\r\n    land.u_eyepos= gl.getUniformLocation(land.landProg, \'eyepos\');\r\n    land.u_light_pos= gl.getUniformLocation(land.landProg, \'light_pos\');\r\n    land.u_shadow_matrix= gl.getUniformLocation(land.landProg, \'shadow_matrix\');\r\n    land.u_offset= gl.getUniformLocation(land.landProg, \'offset\');\r\n    land.u_isN= gl.getUniformLocation(land.landProg, \'isN\');\r\n    land.u_isSH= gl.getUniformLocation(land.landProg, \'isSH\');\r\n    land.u_isSsao= gl.getUniformLocation(land.landProg, \'isSsao\');\r\n    let t0 = gl.getUniformLocation(land.landProg, \'tex\');\r\n    let t1 = gl.getUniformLocation(land.landProg, \'sand_tex\');\r\n    let t2 = gl.getUniformLocation(land.landProg, \'tex_norm\');\r\n    let t3 = gl.getUniformLocation(land.landProg, \'sand_tex_norm\');\r\n    let t4 = gl.getUniformLocation(land.landProg, \'shadow_tex\');\r\n    let t5 = gl.getUniformLocation(land.landProg, \'ao_tex\');\r\n    gl.useProgram(land.landProg);\r\n    gl.uniform1i(land.u_isN, flag.normal);\r\n    gl.uniform1i(land.u_isSH, flag.shadow);\r\n    gl.uniform1i(land.u_isSsao, flag.ssao);\r\n\r\n    gl.uniform1i(t0, 0);\r\n    gl.uniform1i(t1, 1);\r\n    gl.uniform1i(t2, 2);\r\n    gl.uniform1i(t3, 3);\r\n    gl.uniform1i(t4, 4);\r\n    gl.uniform1i(t5, 5);\r\n\r\n    land.trans = esm["a" /* mat4 */].create();\r\n    land.shadow_matrix = esm["a" /* mat4 */].create();\r\n    //shadow matrix\r\n    esm["a" /* mat4 */].fromTranslation(land.shadow_matrix, esm["c" /* vec3 */].fromValues(0.5, 0.5, 0.5));\r\n    esm["a" /* mat4 */].scale(land.shadow_matrix, land.shadow_matrix, esm["c" /* vec3 */].fromValues(0.5, 0.5, 0.5));\r\n    esm["a" /* mat4 */].multiply(land.shadow_matrix,land.shadow_matrix,lightvp);\r\n\r\n    gl.uniform3fv(land.u_eyepos, trackball.camPos);\r\n    gl.uniform3fv(land.u_light_pos, light_pos);\r\n    gl.uniformMatrix4fv(land.u_shadow_matrix, false, land.shadow_matrix);//todo\r\n\r\n    //generate map \r\n    land.data.length = worldWidth * worldDepth;\r\n    land.offset = new Float32Array( worldWidth * worldDepth * 3);\r\n    land_genHeight();\r\n    land_genMap();\r\n}\r\n\r\nfunction land_genHeight(){\r\n\tlet\tsize = worldWidth * worldDepth;\r\n\t\r\n    let\tquality = 2;\r\n\tlet z = Math.random() * 100;\r\n\r\n    for (let j = 0; j < 4; j++) {\r\n\r\n\t\tif (j == 0) \r\n\t\t\tfor (let i = 0; i < size; i++) land.data[i] = 0;\r\n\r\n\t\tfor (let i = 0; i < size; i++) {\r\n\r\n\t\t\tlet x = i % worldWidth, y = (i / worldWidth) | 0;\r\n\t\t\tland.data[i] += perlin.noise(x / quality, y / quality, z) * quality;\r\n\t\t}\r\n\r\n\t\tquality *= 4;\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction getY(x, z){\r\n\treturn Math.floor( land.data[x + z * worldWidth] * 0.2);\r\n}\r\n\r\nfunction land_genMap(){\r\n    console.log("land_genMap");\r\n    let i = 0;\r\n    let max = 0;\r\n    let min = Infinity;\r\n\r\n\tfor (let z = 0; z < worldDepth; z++) {\r\n\t\tfor (let x = 0; x < worldWidth; x++) {\r\n\r\n\t\t\tlet h = getY(x, z);\r\n\t\t\tif (h > max) max = h;\r\n\t\t\tif (h < min) min = h;\r\n            //printf("h = %f\\n", h);\r\n            var newpos = esm["c" /* vec3 */].fromValues(\r\n                x - worldHalfWidth,\r\n\t\t\t\th,\r\n\t\t\t\tz - worldHalfDepth);\r\n            // land.offset.push(newpos);\r\n            land.offset[i * 3] = newpos[0];\r\n            land.offset[i * 3 + 1] = newpos[1];\r\n            land.offset[i * 3 + 2] = newpos[2];\r\n            \r\n\t\t\ti++;\r\n\r\n\t\t}\r\n    }\r\n   \r\n}\r\n\r\nfunction skybox_createShader(){\r\n    // get shader string\r\n    let vsSrc = document.getElementById(\'skybox.vs\').innerText.trim();\r\n    let fsSrc = document.getElementById(\'skybox.fs\').innerText.trim();\r\n\r\n    skybox.program = create_program(vsSrc, fsSrc);\r\n    skybox.u_pvm = gl.getUniformLocation(skybox.program, \'pvm\');\r\n    \r\n}\r\n\r\nfunction create_program(vsSrc,fsSrc){\r\n    // create vertex shader\r\n    let vs = gl.createShader(gl.VERTEX_SHADER);\r\n    gl.shaderSource(vs, vsSrc);\r\n    gl.compileShader(vs);\r\n\r\n    if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)) {\r\n        console.error(gl.getShaderInfoLog(vs));\r\n    }\r\n\r\n    // create fragment shader\r\n    let fs = gl.createShader(gl.FRAGMENT_SHADER);\r\n    gl.shaderSource(fs, fsSrc);\r\n    gl.compileShader(fs);\r\n\r\n    if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)) {\r\n        console.error(gl.getShaderInfoLog(fs));\r\n    }\r\n\r\n    // create shader program\r\n    let prog = gl.createProgram();\r\n    gl.attachShader(prog, vs);\r\n    gl.attachShader(prog, fs);\r\n    gl.linkProgram(prog);\r\n\r\n    if (!gl.getProgramParameter(prog, gl.LINK_STATUS)) {\r\n        console.error(gl.getProgramInfoLog(prog));\r\n    }\r\n    return prog;\r\n}\r\n\r\nfunction _loadFile(url) {\r\n    let fr = new FileReader();\r\n    return new Promise((resolve, reject) => {\r\n        let req = new XMLHttpRequest();\r\n        req.open(\'GET\', url, true);\r\n        req.responseType = \'blob\';\r\n        req.onload = () => {\r\n            fr.readAsText(req.response);\r\n            fr.onload = (e) => {\r\n                let f = e.target.result;\r\n                let ls = f.split(/\\r?\\n/);\r\n                resolve(ls);\r\n            };\r\n        }\r\n        req.onerror = () => {\r\n            reject(new Error(`Failed to load file\'s url: ${url}`));\r\n        };\r\n        req.send();\r\n    });\r\n}\r\n\r\nasync function loadObj(url) {\r\n    // read file\r\n    let lines = await _loadFile(url);\r\n\r\n    // parse obj format\r\n    let v = [];\r\n    let vt = [];\r\n    let vn = [];\r\n    let idx = [];\r\n\r\n    for (let line of lines) {\r\n        line = line.split(\' \');\r\n        // console.log(line);\r\n        if (line[0] == \'v\') {\r\n            v.push(parseFloat(line[1]));\r\n            v.push(parseFloat(line[2]));\r\n            v.push(parseFloat(line[3]));\r\n        }\r\n        else if (line[0] == \'vn\') {\r\n            vn.push(parseFloat(line[1]));\r\n            vn.push(parseFloat(line[2]));\r\n            vn.push(parseFloat(line[3]));\r\n        }\r\n        else if (line[0] == \'vt\') {\r\n            vt.push(parseFloat(line[1]));\r\n            // flip vertically\r\n            vt.push(1.0 - parseFloat(line[2]));\r\n        }\r\n        else if (line[0] == \'f\') {\r\n            // start from zero\r\n            idx.push(parseInt(line[1].split(\'/\')[0]) - 1);\r\n            idx.push(parseInt(line[2].split(\'/\')[0]) - 1);\r\n            idx.push(parseInt(line[3].split(\'/\')[0]) - 1);\r\n        }\r\n    }\r\n\r\n    // compute tangent\r\n    let tn = [];\r\n    for (let i = 0; i < idx.length; i+=3) {\r\n        let idx1 = idx[i];\r\n        let idx2 = idx[i + 1];\r\n        let idx3 = idx[i + 2];\r\n\r\n        let p1 = esm["c" /* vec3 */].fromValues(v[idx1 * 3 + 0], v[idx1 * 3 + 1], v[idx1 * 3 + 2]);\r\n        let p2 = esm["c" /* vec3 */].fromValues(v[idx2 * 3 + 0], v[idx2 * 3 + 1], v[idx2 * 3 + 2]);\r\n        let p3 = esm["c" /* vec3 */].fromValues(v[idx3 * 3 + 0], v[idx3 * 3 + 1], v[idx3 * 3 + 2]);\r\n\r\n        let n1 = esm["c" /* vec3 */].fromValues(vn[idx1 * 3 + 0], vn[idx1 * 3 + 1], vn[idx1 * 3 + 2]);\r\n        let n2 = esm["c" /* vec3 */].fromValues(vn[idx2 * 3 + 0], vn[idx2 * 3 + 1], vn[idx2 * 3 + 2]);\r\n        let n3 = esm["c" /* vec3 */].fromValues(vn[idx3 * 3 + 0], vn[idx3 * 3 + 1], vn[idx3 * 3 + 2]);\r\n\r\n        let uv1 = esm["b" /* vec2 */].fromValues(vt[idx1 * 2 + 0], vt[idx1 * 2 + 1]);\r\n        let uv2 = esm["b" /* vec2 */].fromValues(vt[idx2 * 2 + 0], vt[idx2 * 2 + 1]);\r\n        let uv3 = esm["b" /* vec2 */].fromValues(vt[idx3 * 2 + 0], vt[idx3 * 2 + 1]);\r\n\r\n        let dp1 = esm["c" /* vec3 */].create(); esm["c" /* vec3 */].sub(dp1, p2, p1);\r\n        let dp2 = esm["c" /* vec3 */].create(); esm["c" /* vec3 */].sub(dp2, p3, p1);\r\n\r\n        let duv1 = esm["b" /* vec2 */].create(); esm["b" /* vec2 */].sub(duv1, uv2, uv1);\r\n        let duv2 = esm["b" /* vec2 */].create(); esm["b" /* vec2 */].sub(duv2, uv3, uv1);\r\n\r\n        let r = 1.0 / (duv1[0] * duv2[1] - duv1[1] * duv2[0]);\r\n\r\n        let t = esm["c" /* vec3 */].fromValues(\r\n            (dp1[0] * duv2[1] - dp2[0] * duv1[1]) * r,\r\n            (dp1[1] * duv2[1] - dp2[1] * duv1[1]) * r,\r\n            (dp1[2] * duv2[1] - dp2[2] * duv1[1]) * r\r\n        );\r\n\r\n        let t1 = esm["c" /* vec3 */].create(); esm["c" /* vec3 */].cross(t1, n1, t);\r\n        let t2 = esm["c" /* vec3 */].create(); esm["c" /* vec3 */].cross(t2, n2, t);\r\n        let t3 = esm["c" /* vec3 */].create(); esm["c" /* vec3 */].cross(t3, n3, t);\r\n\r\n        tn[idx1 * 3 + 0] = t1[0];\r\n        tn[idx1 * 3 + 1] = t1[1];\r\n        tn[idx1 * 3 + 2] = t1[2];\r\n\r\n        tn[idx2 * 3 + 0] = t2[0];\r\n        tn[idx2 * 3 + 1] = t2[1];\r\n        tn[idx2 * 3 + 2] = t2[2];\r\n\r\n        tn[idx3 * 3 + 0] = t3[0];\r\n        tn[idx3 * 3 + 1] = t3[1];\r\n        tn[idx3 * 3 + 2] = t3[2];\r\n    }\r\n\r\n    // stats\r\n    console.log(`Load ${url}: ${v.length} vertices, ${vt.length} texcoords, ${vn.length} normals ` +\r\n                `${tn.length} tangents ${idx.length / 3} faces`);\r\n    \r\n    // vao\r\n    land.vao = gl.createVertexArray();\r\n    gl.bindVertexArray(land.vao);\r\n\r\n    // vbo\r\n    let positions = new Float32Array(v);\r\n    let normals = new Float32Array(vn);\r\n    let texcoords = new Float32Array(vt);\r\n    let tangents = new Float32Array(tn);\r\n\r\n    let vbo = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\r\n    gl.bufferData(gl.ARRAY_BUFFER, positions.byteLength + normals.byteLength + texcoords.byteLength + tangents.byteLength, gl.STATIC_DRAW);\r\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, positions);\r\n    gl.bufferSubData(gl.ARRAY_BUFFER, positions.byteLength, normals);\r\n    gl.bufferSubData(gl.ARRAY_BUFFER, positions.byteLength + normals.byteLength, texcoords);\r\n    gl.bufferSubData(gl.ARRAY_BUFFER, positions.byteLength + normals.byteLength + texcoords.byteLength, tangents);\r\n\r\n    gl.vertexAttribPointer(0, 3, gl.FLOAT, false, 0, 0);\r\n    gl.enableVertexAttribArray(0);\r\n    gl.vertexAttribPointer(1, 3, gl.FLOAT, false, 0, positions.byteLength);\r\n    gl.enableVertexAttribArray(1);\r\n    gl.vertexAttribPointer(2, 2, gl.FLOAT, false, 0, positions.byteLength + normals.byteLength);\r\n    gl.enableVertexAttribArray(2);\r\n    gl.vertexAttribPointer(3, 3, gl.FLOAT, false, 0, positions.byteLength + normals.byteLength + texcoords.byteLength);\r\n    gl.enableVertexAttribArray(3);\r\n\r\n\r\n    // ebo\r\n    let indices  = new Uint32Array(idx);\r\n    let ebo = gl.createBuffer();\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ebo);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);\r\n    land.indexCount = idx.length;\r\n    \r\n    // free array\r\n    v.length = 0;\r\n    vt.length = 0;\r\n    vn.length = 0;\r\n    idx.length = 0;\r\n    tn.length = 0;\r\n\r\n    gl.bindVertexArray(null);\r\n    return true;\r\n}\r\n\r\nfunction loadImage(url) {\r\n    return new Promise((resolve, reject) => {\r\n        let img = new Image();\r\n        img.onload = () => {\r\n            resolve(img);\r\n        };\r\n        img.onerror = () => {\r\n            reject(new Error(`Failed to load image\'s url: ${url}`));\r\n        }\r\n        img.src = url;\r\n        img.crossOrigin = \'anonymous\';\r\n    });\r\n}\r\n\r\nasync function loadAsset() {\r\n    // // obj\r\n    let ret = await loadObj(\'./asset/plane.obj\');\r\n    \r\n    //load land texture todo\r\n    let land_promises = [];\r\n    land_promises.push(loadImage(\'./asset/grass_side.png\'));//0\r\n    land_promises.push(loadImage(\'./asset/grass_top.png\'));//1\r\n    land_promises.push(loadImage(\'./asset/sand.png\'));//2\r\n    land_promises.push(loadImage(\'./asset/grass_side_n.png\'));//3\r\n    land_promises.push(loadImage(\'./asset/grass_top_n.png\'));//4\r\n    land_promises.push(loadImage(\'./asset/sand_n.png\'));//5\r\n    let land_res = await Promise.all(land_promises);\r\n    for (let i=0; i<6; i++) {\r\n        land.tex[i] = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, land.tex[i]);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, land_res[i]);\r\n            console.log(land_res[i]);\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);//gl.REPEAT\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n    }\r\n    land_res.length = 0;\r\n\r\n    //load skybox\r\n    let promises = [];\r\n    promises.push(loadImage(\'./asset/face-r.png\'));\r\n    promises.push(loadImage(\'./asset/face-l.png\'));\r\n    promises.push(loadImage(\'./asset/face-t.png\'));\r\n    promises.push(loadImage(\'./asset/face-bot.png\'));\r\n    promises.push(loadImage(\'./asset/face-fr.png\'));\r\n    promises.push(loadImage(\'./asset/face-ba.png\'));\r\n    let results = await Promise.all(promises);\r\n    let sky_tex = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, sky_tex);\r\n    \r\n    for (let i=0; i<6; i++) {\r\n        gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, \r\n            0, gl.RGBA,results[i].width, results[i].height,0, gl.RGBA, gl.UNSIGNED_BYTE, results[i]);\r\n    }\r\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_R, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n    skybox.vao = gl.createVertexArray();\r\n\r\n    results.length = 0;\r\n\r\n}\r\n\r\nfunction render(delta, time) {\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n    gl.clearColor(1.0, 1.0, 1.0, 1.0);\r\n    skybox_render();\r\n    depth_render();\r\n    ssao_render();\r\n    test_render();\r\n    land_render();\r\n}\r\n\r\nfunction test_render(){\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.useProgram(test.program);\r\n\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, test.fbo);\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n    gl.drawBuffers([gl.COLOR_ATTACHMENT0]);\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_2D, ssao.depth_tex);\r\n    gl.activeTexture(gl.TEXTURE1);\r\n    gl.bindTexture(gl.TEXTURE_2D, ssao.norm_tex);\r\n    gl.activeTexture(gl.TEXTURE2);\r\n    gl.bindTexture(gl.TEXTURE_2D, ssao.noise_map);\r\n\r\n    gl.bindBufferBase(gl.UNIFORM_BUFFER, 0, test.kernel_ubo);\r\n    gl.uniform2fv(test.u_noise_scale, esm["b" /* vec2 */].fromValues(window.innerWidth/4, window.innerHeight/4));\r\n    gl.uniformMatrix4fv(test.u_p, false, matrix.p);\r\n\r\n    gl.bindVertexArray(test.vao);\r\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n}\r\n\r\nfunction ssao_render(){\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, ssao.fbo);\r\n\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n    gl.drawBuffers([gl.COLOR_ATTACHMENT0]);\r\n\r\n    gl.enable(gl.POLYGON_OFFSET_FILL);\r\n    //gl.polygonOffset(4, 4);\r\n\r\n    gl.useProgram(ssao.program);\r\n    gl.uniformMatrix4fv(ssao.u_v, false, matrix.v);\r\n    gl.uniformMatrix4fv(ssao.u_p, false, matrix.p);\r\n    rendervao(\'ssao\');\r\n    gl.disable(gl.POLYGON_OFFSET_FILL);\r\n\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n}\r\n\r\nfunction depth_render(){\r\n    gl.viewport(0, 0, depth_size, depth_size);\r\n    gl.enable(gl.DEPTH_TEST);\r\n   \r\n    gl.useProgram(depth.program);\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, depth.fbo);\r\n    \r\n    gl.clear(gl.DEPTH_BUFFER_BIT);\r\n    gl.enable(gl.POLYGON_OFFSET_FILL);\r\n    gl.polygonOffset(4, 4);\r\n\r\n    gl.uniformMatrix4fv(depth.u_vp, false, lightvp);//todo\r\n    rendervao(\'depth\');\r\n    gl.disable(gl.POLYGON_OFFSET_FILL);\r\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n}\r\n\r\nfunction land_render(){\r\n    //todo\r\n    gl.useProgram(land.landProg);\r\n    gl.uniformMatrix4fv(land.u_v, false, matrix.v);\r\n    gl.uniformMatrix4fv(land.u_p, false, matrix.p);\r\n\r\n    gl.activeTexture(gl.TEXTURE0);//tex_top\r\n    gl.bindTexture(gl.TEXTURE_2D, land.tex[1]);\r\n    gl.activeTexture(gl.TEXTURE1);//tex_sand\r\n    gl.bindTexture(gl.TEXTURE_2D, land.tex[2]);\r\n    gl.activeTexture(gl.TEXTURE2);//tex_top_norm\r\n    gl.bindTexture(gl.TEXTURE_2D, land.tex[4]);\r\n    gl.activeTexture(gl.TEXTURE3);//tex_sand_norm\r\n    gl.bindTexture(gl.TEXTURE_2D, land.tex[5]);\r\n    gl.activeTexture(gl.TEXTURE4);//shadow\r\n    gl.bindTexture(gl.TEXTURE_2D, depth.tex);\r\n    gl.activeTexture(gl.TEXTURE5);//ao_tes\r\n    gl.bindTexture(gl.TEXTURE_2D, test.ao_tex);\r\n    //gl.bindTexture(gl.TEXTURE_2D, ssao.noise_map);    \r\n    rendervao(\'land\');\r\n\r\n}\r\nfunction deg2rad(x){\r\n    return x * Math.PI / 180;\r\n}\r\nfunction rendervao(mode){\r\n    let size = worldDepth * worldWidth;\r\n    gl.bindVertexArray(land.vao);\r\n    let r1 = esm["a" /* mat4 */].create();\r\n    esm["a" /* mat4 */].fromXRotation(r1, deg2rad(0));\r\n    let r2 = esm["a" /* mat4 */].create();\r\n    esm["a" /* mat4 */].fromYRotation(r2, deg2rad(0));\r\n    let tr = esm["a" /* mat4 */].create();\r\n    esm["a" /* mat4 */].fromTranslation(tr, esm["c" /* vec3 */].fromValues(0, 0.5, 0));\r\n    esm["a" /* mat4 */].multiply(land.trans, r1, r2);\r\n    esm["a" /* mat4 */].multiply(land.trans, land.trans, tr);\r\n    for(let j=0; j<5; j++){\r\n        if(j===1){//front\r\n            if(mode === \'land\'){\r\n                gl.activeTexture(gl.TEXTURE0);\r\n                gl.bindTexture(gl.TEXTURE_2D, land.tex[0]);\r\n                gl.activeTexture(gl.TEXTURE2);\r\n                gl.bindTexture(gl.TEXTURE_2D, land.tex[3]);\r\n            }\r\n            esm["a" /* mat4 */].fromXRotation(r2, deg2rad(90));\r\n            esm["a" /* mat4 */].fromYRotation(r1, deg2rad(0));\r\n            esm["a" /* mat4 */].fromTranslation(tr, esm["c" /* vec3 */].fromValues(0, 0, 0.5));\r\n        }\r\n        else if(j===2){//left\r\n            esm["a" /* mat4 */].fromXRotation(r2, deg2rad(90));\r\n            esm["a" /* mat4 */].fromYRotation(r1, deg2rad(-90));\r\n            esm["a" /* mat4 */].fromTranslation(tr, esm["c" /* vec3 */].fromValues(-0.5, 0, 0));\r\n        }\r\n        else if(j===3){//back\r\n            esm["a" /* mat4 */].fromXRotation(r2, deg2rad(90));\r\n            esm["a" /* mat4 */].fromYRotation(r1, deg2rad(180));\r\n            esm["a" /* mat4 */].fromTranslation(tr, esm["c" /* vec3 */].fromValues(0, 0, -0.5));\r\n        }\r\n        else if(j===4){//right\r\n            esm["a" /* mat4 */].fromXRotation(r2, deg2rad(90));\r\n            esm["a" /* mat4 */].fromYRotation(r1, deg2rad(90));\r\n            esm["a" /* mat4 */].fromTranslation(tr, esm["c" /* vec3 */].fromValues(0.5, 0, 0));\r\n        }\r\n        esm["a" /* mat4 */].multiply(land.trans, tr, r1);\r\n        esm["a" /* mat4 */].multiply(land.trans, land.trans, r2);\r\n        \r\n        let num = 300;\r\n        if(mode === \'land\'){\r\n            gl.uniformMatrix4fv(land.u_trans, false, land.trans);\r\n            for (let i = 0; i < size; i += 300) {\r\n                if (i + 300 > size) num = size - i;\r\n                gl.uniform3fv(land.u_offset, land.offset.subarray(i * 3));       \r\n                gl.drawElementsInstanced(gl.TRIANGLES, land.indexCount,\r\n                    gl.UNSIGNED_INT, 0, num);\r\n            }\r\n        }\r\n        else if(mode === \'depth\'){\r\n            gl.uniformMatrix4fv(depth.u_trans, false, land.trans);\r\n            for (let i = 0; i < size; i += 300) {\r\n                if (i + 300 > size) num = size - i;\r\n                gl.uniform3fv(depth.u_offset, land.offset.subarray(i * 3));         \r\n                gl.drawElementsInstanced(gl.TRIANGLES, land.indexCount,\r\n                    gl.UNSIGNED_INT, 0, num);\r\n            }\r\n\r\n        }\r\n        else if(mode === \'ssao\'){\r\n            gl.uniformMatrix4fv(ssao.u_trans, false, land.trans);\r\n            for (let i = 0; i < size; i += 300) {\r\n                if (i + 300 > size) num = size - i;\r\n                gl.uniform3fv(ssao.u_offset, land.offset.subarray(i * 3));       \r\n                gl.drawElementsInstanced(gl.TRIANGLES, land.indexCount,\r\n                    gl.UNSIGNED_INT, 0, num);\r\n            }\r\n        }\r\n    \r\n    }\r\n}\r\n\r\nfunction skybox_render(){\r\n    gl.useProgram(skybox.program);\r\n\r\n    // set uniform\r\n    let pvm = esm["a" /* mat4 */].create();\r\n    esm["a" /* mat4 */].multiply(pvm, matrix.p, matrix.v);\r\n    gl.uniformMatrix4fv(skybox.u_pvm, false, pvm);\r\n\r\n    // drawing command\r\n    gl.bindVertexArray(skybox.vao);\r\n    gl.disable(gl.DEPTH_TEST);\r\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    gl.enable(gl.DEPTH_TEST);\r\n\r\n}\r\n\r\nfunction trackball_update(type){\r\n    let sp_vec = esm["c" /* vec3 */].fromValues( 0, trackball.speed, 0);//updown\r\n    let fr_vec = esm["c" /* vec3 */].create();//frontback\r\n    esm["c" /* vec3 */].scale(fr_vec, trackball.camFront, trackball.speed);\r\n    let lr_vec = esm["c" /* vec3 */].create();//leftright\r\n    esm["c" /* vec3 */].normalize(lr_vec, esm["c" /* vec3 */].cross(lr_vec, trackball.camFront, trackball.camUp));\r\n    esm["c" /* vec3 */].scale(lr_vec, lr_vec, trackball.speed);\r\n    if(type === \'Tpress\'){\r\n        if(keyPress.Z === true) esm["c" /* vec3 */].add(trackball.camPos, trackball.camPos, sp_vec);\r\n        if(keyPress.X === true) esm["c" /* vec3 */].subtract(trackball.camPos, trackball.camPos, sp_vec);\r\n        if(keyPress.W === true) esm["c" /* vec3 */].add(trackball.camPos, trackball.camPos, fr_vec);\r\n        if(keyPress.S === true) esm["c" /* vec3 */].subtract(trackball.camPos, trackball.camPos, fr_vec);\r\n        if(keyPress.A === true) esm["c" /* vec3 */].subtract(trackball.camPos, trackball.camPos, lr_vec);\r\n        if(keyPress.D === true) esm["c" /* vec3 */].add(trackball.camPos, trackball.camPos, lr_vec);\r\n    }\r\n    else{\r\n\t\ttrackball.degree_x = mouse.diff_x * trackball.sensitivity;\r\n\t\ttrackball.degree_y = mouse.diff_y * trackball.sensitivity;\r\n\t\ttrackball.x_yaw += trackball.degree_x;\r\n\t\ttrackball.y_pitch += trackball.degree_y;\r\n\r\n\t\tif (trackball.y_pitch > 89.0)\r\n        trackball.y_pitch = 89.0;\r\n\t\tif (trackball.y_pitch < -89.0)\r\n        trackball.y_pitch = -89.0;\r\n        let x = Math.cos(radians(trackball.y_pitch)) * Math.cos(radians(trackball.x_yaw));\r\n        let y =Math.sin(radians(trackball.y_pitch));\r\n        let z =  Math.cos(radians(trackball.y_pitch)) * Math.sin(radians(trackball.x_yaw));\r\n        esm["c" /* vec3 */].set(trackball.lfront, x, y, z);\r\n        \r\n\t\tesm["c" /* vec3 */].normalize(trackball.camFront, trackball.lfront);\r\n    }\r\n    let out = esm["c" /* vec3 */].create();\r\n    esm["c" /* vec3 */].add(out,trackball.camPos ,trackball.camFront);\r\n    esm["a" /* mat4 */].lookAt(matrix.v, trackball.camPos, out, trackball.camUp);\r\n}\r\n\r\nfunction radians(num){\r\n    return  num * Math.PI / 180;\r\n}\r\n\r\nfunction animate(time) {\r\n    if (!global.start) {\r\n        global.start = time;\r\n    }\r\n    // in milliseconds\r\n    let delta = time - global.start;\r\n    global.start = time;\r\n\r\n    stats.update();\r\n\r\n    //trackball\r\n    if(keyPress.on === true){\r\n        trackball_update(\'Tpress\');\r\n    }\r\n    if(mouse.down ===true){\r\n        trackball_update(\'Tlook\');\r\n    }\r\n\r\n    render(delta, time);\r\n\r\n    window.requestAnimationFrame(animate);\r\n}\r\n\r\nwindow.onresize = () => {\r\n    let canvas = document.querySelector(\'canvas\');\r\n\r\n    if (gl && canvas) {\r\n        canvas.width = window.innerWidth;\r\n        canvas.height = window.innerHeight;\r\n        esm["a" /* mat4 */].perspective(matrix.p, radians(60), gl.drawingBufferWidth / gl.drawingBufferHeight, 0.1, 1000.0);\r\n        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n    }\r\n}\r\n\r\nwindow.onload = () => {\r\n    initWebGL();\r\n    createShader();\r\n    loadAsset().then(() => {\r\n        // rendering loop\r\n        window.requestAnimationFrame(animate);\r\n    });\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9wZXJsaW4uanM/YjZmMSIsIndlYnBhY2s6Ly8vLi9tYWluLmpzPzFkNTAiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGVybGlue1xyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICB0aGlzLnAgPSAgWyAxNTEsIDE2MCwgMTM3LCA5MSwgOTAsIDE1LCAxMzEsIDEzLCAyMDEsIDk1LCA5NiwgNTMsIDE5NCwgMjMzLCA3LCAyMjUsIDE0MCwgMzYsIDEwMywgMzAsIDY5LCAxNDIsIDgsIDk5LCAzNywgMjQwLCAyMSwgMTAsXHJcbiAgICAgICAgICAgIDIzLCAxOTAsIDYsIDE0OCwgMjQ3LCAxMjAsIDIzNCwgNzUsIDAsIDI2LCAxOTcsIDYyLCA5NCwgMjUyLCAyMTksIDIwMywgMTE3LCAzNSwgMTEsIDMyLCA1NywgMTc3LCAzMywgODgsIDIzNywgMTQ5LCA1NiwgODcsXHJcbiAgICAgICAgICAgIDE3NCwgMjAsIDEyNSwgMTM2LCAxNzEsIDE2OCwgNjgsIDE3NSwgNzQsIDE2NSwgNzEsIDEzNCwgMTM5LCA0OCwgMjcsIDE2NiwgNzcsIDE0NiwgMTU4LCAyMzEsIDgzLCAxMTEsIDIyOSwgMTIyLCA2MCwgMjExLFxyXG4gICAgICAgICAgICAxMzMsIDIzMCwgMjIwLCAxMDUsIDkyLCA0MSwgNTUsIDQ2LCAyNDUsIDQwLCAyNDQsIDEwMiwgMTQzLCA1NCwgNjUsIDI1LCA2MywgMTYxLCAxLCAyMTYsIDgwLCA3MywgMjA5LCA3NiwgMTMyLCAxODcsIDIwOCxcclxuICAgICAgICAgICAgODksIDE4LCAxNjksIDIwMCwgMTk2LCAxMzUsIDEzMCwgMTE2LCAxODgsIDE1OSwgODYsIDE2NCwgMTAwLCAxMDksIDE5OCwgMTczLCAxODYsIDMsIDY0LCA1MiwgMjE3LCAyMjYsIDI1MCwgMTI0LCAxMjMsIDUsXHJcbiAgICAgICAgICAgIDIwMiwgMzgsIDE0NywgMTE4LCAxMjYsIDI1NSwgODIsIDg1LCAyMTIsIDIwNywgMjA2LCA1OSwgMjI3LCA0NywgMTYsIDU4LCAxNywgMTgyLCAxODksIDI4LCA0MiwgMjIzLCAxODMsIDE3MCwgMjEzLCAxMTksXHJcbiAgICAgICAgICAgIDI0OCwgMTUyLCAyLCA0NCwgMTU0LCAxNjMsIDcwLCAyMjEsIDE1MywgMTAxLCAxNTUsIDE2NywgNDMsIDE3MiwgOSwgMTI5LCAyMiwgMzksIDI1MywgMTksIDk4LCAxMDgsIDExMCwgNzksIDExMywgMjI0LCAyMzIsXHJcbiAgICAgICAgICAgIDE3OCwgMTg1LCAxMTIsIDEwNCwgMjE4LCAyNDYsIDk3LCAyMjgsIDI1MSwgMzQsIDI0MiwgMTkzLCAyMzgsIDIxMCwgMTQ0LCAxMiwgMTkxLCAxNzksIDE2MiwgMjQxLCA4MSwgNTEsIDE0NSwgMjM1LCAyNDksXHJcbiAgICAgICAgICAgIDE0LCAyMzksIDEwNywgNDksIDE5MiwgMjE0LCAzMSwgMTgxLCAxOTksIDEwNiwgMTU3LCAxODQsIDg0LCAyMDQsIDE3NiwgMTE1LCAxMjEsIDUwLCA0NSwgMTI3LCA0LCAxNTAsIDI1NCwgMTM4LCAyMzYsIDIwNSxcclxuICAgICAgICAgICAgOTMsIDIyMiwgMTE0LCA2NywgMjksIDI0LCA3MiwgMjQzLCAxNDEsIDEyOCwgMTk1LCA3OCwgNjYsIDIxNSwgNjEsIDE1NiwgMTgwIF07XHJcbiAgICB9XHJcbiAgICBwZXJsaW4oeCwgeSwgeikge1xyXG4gICAgICAgIGxldCBmbG9vclggPU1hdGguZmxvb3IoeCksIGZsb29yWSA9IE1hdGguZmxvb3IoeSksIGZsb29yWiA9IE1hdGguZmxvb3Ioeik7XHJcblxyXG5cdFx0bGV0IFggPSBmbG9vclggJiAyNTUsIFkgPSBmbG9vclkgJiAyNTUsIFogPSBmbG9vclogJiAyNTU7XHJcblxyXG5cdFx0eCAtPSBmbG9vclg7XHJcblx0XHR5IC09IGZsb29yWTtcclxuXHRcdHogLT0gZmxvb3JaO1xyXG5cclxuXHRcdC8vcHJpbnRmKFwieCAlZiwgeT0gJWYsIHo9ICVmXFxuXCIsIHgsIHksIHopO1xyXG5cdFx0bGV0IHhNaW51czEgPSB4IC0gMSwgeU1pbnVzMSA9IHkgLSAxLCB6TWludXMxID0geiAtIDE7XHJcblxyXG5cdFx0bGV0IHUgPSB0aGlzLmZhZGUoeCksIHYgPSB0aGlzLmZhZGUoeSksIHcgPSB0aGlzLmZhZGUoeik7XHJcblxyXG5cdFx0bGV0IEEgPSB0aGlzLnBbWF0gKyBZLCBBQSA9IHRoaXMucFtBXSArIFosIEFCID0gdGhpcy5wW0EgKyAxXSArIFosIEIgPSB0aGlzLnBbWCArIDFdICsgWSwgQkEgPSB0aGlzLnBbQl0gKyBaLCBCQiA9IHRoaXMucFtCICsgMV0gKyBaO1xyXG5cclxuXHRcdHJldHVybiB0aGlzLmxlcnAodywgdGhpcy5sZXJwKHYsIHRoaXMubGVycCh1LCB0aGlzLmdyYWQodGhpcy5wW0FBXSwgeCwgeSwgeiksXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0dGhpcy5ncmFkKHRoaXMucFtCQV0sIHhNaW51czEsIHksIHopKSxcclxuXHRcdFx0XHRcdFx0XHRcdHRoaXMubGVycCh1LCB0aGlzLmdyYWQodGhpcy5wW0FCXSwgeCwgeU1pbnVzMSwgeiksXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0dGhpcy5ncmFkKHRoaXMucFtCQl0sIHhNaW51czEsIHlNaW51czEsIHopKSksXHJcblx0XHRcdFx0XHRcdHRoaXMubGVycCh2LCB0aGlzLmxlcnAodSwgdGhpcy5ncmFkKHRoaXMucFtBQSArIDFdLCB4LCB5LCB6TWludXMxKSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aGlzLmdyYWQodGhpcy5wW0JBICsgMV0sIHhNaW51czEsIHksIHogLSAxKSksXHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLmxlcnAodSwgdGhpcy5ncmFkKHRoaXMucFtBQiArIDFdLCB4LCB5TWludXMxLCB6TWludXMxKSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aGlzLmdyYWQodGhpcy5wW0JCICsgMV0sIHhNaW51czEsIHlNaW51czEsIHpNaW51czEpKSkpO1xyXG5cclxuICAgIH1cclxuICAgIGxlcnAodCxhLGIpe1xyXG4gICAgICAgIHJldHVybiBhICsgdCAqIChiLWEpO1xyXG4gICAgfVxyXG4gICAgZmFkZSh0KSB7XHJcblxyXG4gICAgICAgIHJldHVybiB0ICogdCAqIHQgKiAodCAqICh0ICogNiAtIDE1KSArIDEwKTtcclxuICAgIFxyXG4gICAgfVxyXG4gICAgZ3JhZChoYXNoLCB4LCB5LCB6KSB7XHJcblxyXG4gICAgICAgIGxldCBoID0gaGFzaCAmIDE1O1xyXG4gICAgICAgIGxldCB1ID0gaCA8IDggPyB4IDogeSwgXHJcbiAgICAgICAgICAgICAgdiA9IGggPCA0ID8geSA6IGggPT0gMTIgfHwgaCA9PSAxNCA/IHggOiB6O1xyXG4gICAgICAgIHJldHVybiAoKGggJiAxKSA9PSAwID8gdSA6IC11KSArICgoaCAmIDIpID09IDAgPyB2IDogLXYpO1xyXG4gICAgXHJcbiAgICB9XHJcbiAgICBub2lzZSh4LCB5LCB6KXtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMucFsyNTYgKyBpXSA9IHRoaXMucFtpXTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBhID0gdGhpcy5wZXJsaW4oeCwgeSwgeik7XHJcbiAgICAgICAgLy9wcmludGYoXCJub2lzZTogcGVybGluID0gJWZcXG5cIiwgYSk7XHJcbiAgICAgICAgcmV0dXJuIGE7XHJcbiAgICB9XHJcblxyXG59IiwiaW1wb3J0ICogYXMgZ2xtIGZyb20gJ2dsLW1hdHJpeCc7XHJcbmltcG9ydCAqIGFzIFN0YXRzIGZyb20gJ3N0YXRzLWpzJztcclxuaW1wb3J0ICogYXMgRGF0IGZyb20gJ2RhdC5ndWknO1xyXG5pbXBvcnQgKiBhcyBQZXJsaW4gZnJvbSAnLi9wZXJsaW4nO1xyXG5cclxuLy8gZ2xvYmFsIHZhcmlhYmxlXHJcbnZhciBnbCA9IHdpbmRvdy5XZWJHTDJSZW5kZXJpbmdDb250ZXh0LnByb3RvdHlwZTsgLy8gc3BlY2lmeSB0eXBlIGZvciBjb2RlIHNuaXBwZXRcclxudmFyIHN0YXRzID0gbnVsbDtcclxudmFyIGd1aSA9IG51bGw7XHJcbnZhciBwZXJsaW4gPSBudWxsO1xyXG5cclxudmFyIGdsb2JhbCA9IHtcclxuICAgIHByb2dyYW06IG51bGwsXHJcbiAgICBzdGFydDogbnVsbCxcclxufTtcclxudmFyIG1hdHJpeCA9IHtcclxuICAgIG06IG51bGwsXHJcbiAgICB2OiBudWxsLFxyXG4gICAgcDogbnVsbCxcclxufTtcclxudmFyIHVuaWZvcm0gPSB7XHJcbiAgICBtdnA6IG51bGwsXHJcbiAgICBtOiBudWxsLFxyXG4gICAgZXllOiBudWxsLFxyXG4gICAgbGlnaHQ6IG51bGwsXHJcbiAgICBjbzogbnVsbCxcclxuICAgIG5tOiBudWxsLFxyXG4gICAgdXNlOiBudWxsLFxyXG59O1xyXG52YXIgbW9kZWwgPSB7XHJcbiAgICB2YW86IG51bGwsXHJcbiAgICBjdHI6IG51bGwsXHJcbiAgICB0ZXg6IFtdLFxyXG59O1xyXG52YXIgZmxhZyA9IHtcclxuICAgIG5vcm1hbDogZmFsc2UsXHJcbiAgICBzaGFkb3c6IGZhbHNlLFxyXG4gICAgc3NhbzogZmFsc2UsXHJcbn07XHJcblxyXG52YXIgdHJhY2tiYWxsID0ge1xyXG4gICAgeF95YXcgOiBudWxsLFxyXG4gICAgeV9waXRjaCA6ICBudWxsLFxyXG5cdGRlZ3JlZV94IDogbnVsbCxcclxuXHRkZWdyZWVfeSA6IG51bGwsXHJcblx0bGZyb250IDpudWxsLFxyXG4gICAgc2Vuc2l0aXZpdHkgOiBudWxsLFxyXG5cdHNwZWVkIDogbnVsbCxcclxuXHRjYW1Qb3MgOm51bGwsXHJcblx0Y2FtRnJvbnQgOiBudWxsLFxyXG5cdGNhbVVwIDogbnVsbCxcclxufTtcclxuXHJcbnZhciBrZXlQcmVzcyA9IHtcclxuICAgIFc6IGZhbHNlLFxyXG4gICAgQTogZmFsc2UsXHJcbiAgICBTOiBmYWxzZSxcclxuICAgIEQ6IGZhbHNlLFxyXG4gICAgWjogZmFsc2UsXHJcbiAgICBYOiBmYWxzZSxcclxuICAgIG9uOmZhbHNlLFxyXG59XHJcblxyXG52YXIgbW91c2UgPSB7XHJcbiAgICBkb3duOmZhbHNlLFxyXG4gICAgZGlmZl94Om51bGwsXHJcbiAgICBkaWZmX3k6bnVsbCxcclxuICAgIGxhc3RfeDpudWxsLFxyXG4gICAgbGFzdF95Om51bGwsXHJcbn1cclxudmFyIHNreWJveCA9IHtcclxuICAgIHByb2dyYW06IG51bGwsXHJcbiAgICB2YW86IG51bGwsXHJcbiAgICB1X3B2bTogbnVsbCxcclxufVxyXG52YXIgbGFuZCA9IHtcclxuICAgIGxhbmRQcm9nOiBudWxsLFxyXG4gICAgdmFvOm51bGwsXHJcbiAgICBpbmRleENvdW50Om51bGwsXHJcbiAgICB1X3Y6bnVsbCxcclxuICAgIHVfcDpudWxsLFxyXG4gICAgdV90cmFuczogbnVsbCxcclxuICAgIHVfZXllcG9zOiBudWxsLFxyXG4gICAgdV9saWdodF9wb3M6IG51bGwsXHJcbiAgICB1X3NoYWRvd19tYXRyaXg6IG51bGwsXHJcbiAgICB1X29mZnNldDpudWxsLFxyXG4gICAgdHJhbnM6bnVsbCxcclxuICAgIHNoYWRvd19tYXRyaXg6bnVsbCxcclxuICAgIG9mZnNldDpudWxsLFxyXG4gICAgdGV4OltdLFxyXG4gICAgZGF0YTpbXSxcclxuICAgIHVfaXNOOmZhbHNlLFxyXG4gICAgdV9pc1NIOmZhbHNlLFxyXG4gICAgdV9pc1NzYW86ZmFsc2UsXHJcbn1cclxudmFyIGRlcHRoID0ge1xyXG4gICAgcHJvZ3JhbTogbnVsbCxcclxuICAgIHVfdnA6IG51bGwsXHJcbiAgICB1X3RyYW5zOiBudWxsLFxyXG4gICAgdV9vZmZzZXQ6IG51bGwsXHJcbiAgICBmYm86IG51bGwsXHJcbiAgICB0ZXg6IG51bGwsICBcclxufTtcclxudmFyIHNzYW8gPSB7XHJcbiAgICBwcm9ncmFtOiBudWxsLFxyXG4gICAgZmJvOiBudWxsLFxyXG4gICAgbm9ybV90ZXg6IG51bGwsICAgXHJcbiAgICBkZXB0aF90ZXg6IG51bGwsICAgXHJcbiAgICBub2lzZV9tYXA6IG51bGwsICAgXHJcbiAgICB1X3Y6IG51bGwsXHJcbiAgICB1X3A6IG51bGwsXHJcbiAgICB1X3RyYW5zOiBudWxsLFxyXG4gICAgdV9vZmZzZXQ6IG51bGwsXHJcbn07XHJcbnZhciB0ZXN0ID0ge1xyXG4gICAgcHJvZ3JhbTogbnVsbCxcclxuICAgIGZibzogbnVsbCxcclxuICAgIHZhbzogbnVsbCxcclxuICAgIHVfcDogbnVsbCxcclxuICAgIHVfbm9pc2Vfc2NhbGU6IG51bGwsXHJcbiAgICBhb190ZXg6IG51bGwsXHJcbiAgICBrZXJuZWxfdWJvOiBudWxsLFxyXG59XHJcbnZhciBsaWdodF9wb3MgPSBnbG0udmVjMy5mcm9tVmFsdWVzKDAsIDEwMCwgMTUwKTtcclxudmFyIGxpZ2h0dnAgPSBnbG0ubWF0NC5jcmVhdGUoKTtcclxudmFyIGRlcHRoX3NpemUgPSA0MDk2O1xyXG52YXIgd29ybGRXaWR0aCA9IDEwMDtcclxudmFyIHdvcmxkRGVwdGggPSAxMDA7XHJcbnZhciB3b3JsZEhhbGZXaWR0aCA9IHdvcmxkV2lkdGggLyAyO1xyXG52YXIgd29ybGRIYWxmRGVwdGggPSB3b3JsZERlcHRoIC8gMjtcclxuZnVuY3Rpb24gaW5pdFdlYkdMKCkge1xyXG4gICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbiAgICBjYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLmFwcGVuZENoaWxkKGNhbnZhcyk7XHJcblxyXG4gICAgZ2wgPSBjYW52YXMuZ2V0Q29udGV4dCgnd2ViZ2wyJyk7XHJcbiAgICBpZiAoIWdsKSB7XHJcbiAgICAgICAgYWxlcnQoJ1dlYkdMIDIgbm90IGF2YWlsYWJsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHdlYmdsIHNldHRpbmdcclxuICAgIGdsLmNsZWFyQ29sb3IoMC4wLCAwLjAsIDAuMCwgMS4wKTtcclxuICAgIGdsLmNsZWFyRGVwdGgoMS4wKTtcclxuICAgIGdsLmVuYWJsZShnbC5ERVBUSF9URVNUKTtcclxuICAgIC8vIGdsLmRlcHRoRnVuYyhnbC5MRVFVQUwpO1xyXG4gICAgZ2wudmlld3BvcnQoMCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTtcclxuXHJcbiAgICAvLyBmcHNcclxuICAgIHN0YXRzID0gbmV3IFN0YXRzKCk7XHJcbiAgICBzdGF0cy5kb21FbGVtZW50LmNsYXNzTGlzdC5hZGQoJ25hdmJhcicpXHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHN0YXRzLmRvbUVsZW1lbnQpO1xyXG5cclxuICAgIC8vIGd1aVxyXG4gICAgZ3VpID0gbmV3IERhdC5HVUkoKTtcclxuICAgIGd1aS5kb21FbGVtZW50LmNsYXNzTGlzdC5hZGQoJ25hdmJhcicpO1xyXG4gICAgbGV0IG5tRm9sZGVyID0gZ3VpLmFkZEZvbGRlcignTm9ybWFsJyk7XHJcbiAgICBubUZvbGRlci5hZGQoZmxhZywgJ25vcm1hbCcpLm9uQ2hhbmdlKCh2YWwpID0+IHtcclxuICAgICAgICBnbC51bmlmb3JtMWkobGFuZC51X2lzTiwgdmFsKTtcclxuICAgIH0pO1xyXG4gICAgbm1Gb2xkZXIuYWRkKGZsYWcsICdzaGFkb3cnKS5vbkNoYW5nZSgodmFsKSA9PiB7XHJcbiAgICAgICAgZ2wudW5pZm9ybTFpKGxhbmQudV9pc1NILCB2YWwpO1xyXG4gICAgfSk7XHJcbiAgICBubUZvbGRlci5hZGQoZmxhZywgJ3NzYW8nKS5vbkNoYW5nZSgodmFsKSA9PiB7XHJcbiAgICAgICAgZ2wudW5pZm9ybTFpKGxhbmQudV9pc1NzYW8sIHZhbCk7XHJcbiAgICB9KTtcclxuICAgIG5tRm9sZGVyLm9wZW4oKTtcclxuXHJcbiAgICAvL3BlcmxpblxyXG4gICAgcGVybGluID0gbmV3IFBlcmxpbi5kZWZhdWx0KCk7XHJcblxyXG5cclxuICAgIFxyXG4gICAgLy9pbml0IHRyYWNrYmFsbFxyXG4gICAgdHJhY2tiYWxsX2luaXQoMC4wMDEsIDAuMDUpO1xyXG4gICAgXHJcbiAgICAvLyBtYXRyaXhcclxuICAgIG1hdHJpeC5tID0gZ2xtLm1hdDQuY3JlYXRlKCk7XHJcbiAgICBtYXRyaXgudiA9IGdsbS5tYXQ0LmNyZWF0ZSgpO1xyXG4gICAgbWF0cml4LnAgPSBnbG0ubWF0NC5jcmVhdGUoKTtcclxuICAgIGdsbS5tYXQ0Lmxvb2tBdChtYXRyaXgudiwgdHJhY2tiYWxsLmNhbVBvcywgdHJhY2tiYWxsLmNhbUZyb250LCB0cmFja2JhbGwuY2FtVXApO1xyXG5cclxuICAgIGdsbS5tYXQ0LnBlcnNwZWN0aXZlKG1hdHJpeC5wLCByYWRpYW5zKDYwKSwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoIC8gZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCwgMC4xLCAxMDAwLjApO1xyXG4gICAgXHJcbiAgICAvL2luaXQgc2t5Ym94LT5jcmVhdGVzaGFkZXJcclxuXHJcbiAgICAvL2luaXQgbGFuZC0+Y3JlYXRlc2hhZGVyXHJcblxyXG59XHJcblxyXG5cclxuXHJcbmZ1bmN0aW9uIHRyYWNrYmFsbF9pbml0KHNlbnMsIHNwKXtcclxuICAgIHRyYWNrYmFsbC54X3lhdyA9IC05MC4wO1xyXG5cdHRyYWNrYmFsbC55X3BpdGNoID0gMC4wO1xyXG5cdHRyYWNrYmFsbC5kZWdyZWVfeCA9IDAuMDtcclxuXHR0cmFja2JhbGwuZGVncmVlX3kgPSAwLjA7XHJcbiAgICB0cmFja2JhbGwubGZyb250ID0gZ2xtLnZlYzMuY3JlYXRlKCk7XHJcbiAgICBnbG0udmVjMy5zZXQodHJhY2tiYWxsLmxmcm9udCwgMCwgMCwgMCk7XHJcblxyXG5cdHRyYWNrYmFsbC5zZW5zaXRpdml0eSA9IHNlbnM7XHJcbiAgICB0cmFja2JhbGwuc3BlZWQgPSBzcDtcclxuXHJcbiAgICB0cmFja2JhbGwuY2FtUG9zID0gZ2xtLnZlYzMuY3JlYXRlKCk7XHJcbiAgICBnbG0udmVjMy5zZXQodHJhY2tiYWxsLmNhbVBvcywgMCwgMSwgNSk7XHJcblxyXG4gICAgdHJhY2tiYWxsLmNhbUZyb250ID0gZ2xtLnZlYzMuY3JlYXRlKCk7XHJcbiAgICBnbG0udmVjMy5zZXQodHJhY2tiYWxsLmNhbUZyb250LCAwLCAwLCAwKTtcclxuICAgIHRyYWNrYmFsbC5jYW1VcCA9IGdsbS52ZWMzLmNyZWF0ZSgpO1xyXG4gICAgZ2xtLnZlYzMuc2V0KHRyYWNrYmFsbC5jYW1VcCwgMCwgMSwgMCk7XHJcblxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ21vdXNlZG93bicsIG9uTW91c2VEb3duICk7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAnbW91c2Vtb3ZlJywgb25Nb3VzZU1vdmUgKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdtb3VzZXVwJywgb25Nb3VzZVVwICk7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAna2V5ZG93bicsIG9uS2V5RG93biwgZmFsc2UgKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdrZXl1cCcsIG9uS2V5VXAsIGZhbHNlICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9uTW91c2VEb3duKGUpe1xyXG4gICAgbW91c2UuZG93biA9IHRydWU7XHJcbiAgICBtb3VzZS5sYXN0X3ggPSBlLmNsaWVudFg7XHJcblx0bW91c2UubGFzdF95ID0gZS5jbGllbnRZO1xyXG4gICAgY29uc29sZS5sb2coJ2Rvd24nKTtcclxufVxyXG5mdW5jdGlvbiBvbk1vdXNlTW92ZShlKXtcclxuICAgIGlmKG1vdXNlLmRvd24gPT09IHRydWUpe1xyXG4gICAgICAgIG1vdXNlLmRpZmZfeCA9IGUuY2xpZW50WCAgLSBtb3VzZS5sYXN0X3g7XHJcbiAgICAgICAgbW91c2UuZGlmZl95ID0gbW91c2UubGFzdF95IC0gZS5jbGllbnRZO1xyXG4gICAgICAgIC8vdXBkYXRlIHZpZXdcclxuICAgICAgICB0cmFja2JhbGxfdXBkYXRlKCdUbG9vaycpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG9uTW91c2VVcChlKXtcclxuICAgIG1vdXNlLmRvd24gPSBmYWxzZTtcclxufVxyXG5cclxuZnVuY3Rpb24gb25LZXlEb3duKGUpe1xyXG4gICAga2V5UHJlc3Mub24gPSB0cnVlO1xyXG4gICAgc3dpdGNoKGUuY29kZSl7XHJcbiAgICAgICAgY2FzZSAnS2V5Vyc6XHJcbiAgICAgICAgICAgIGtleVByZXNzLlcgPSB0cnVlO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0tleUEnOlxyXG4gICAgICAgICAgICBrZXlQcmVzcy5BID0gdHJ1ZTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdLZXlTJzpcclxuICAgICAgICAgICAga2V5UHJlc3MuUyA9IHRydWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnS2V5RCc6XHJcbiAgICAgICAgICAgIGtleVByZXNzLkQgPSB0cnVlO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0tleVonOlxyXG4gICAgICAgICAgICBrZXlQcmVzcy5aID0gdHJ1ZTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdLZXlYJzpcclxuICAgICAgICAgICAga2V5UHJlc3MuWCA9IHRydWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxufVxyXG5cclxuZnVuY3Rpb24gb25LZXlVcChlKXtcclxuICAgIGNvbnNvbGUubG9nKGUuY29kZSArICcgVXAnKTtcclxuICAgIGtleVByZXNzLm9uID0gZmFsc2U7XHJcbiAgICBzd2l0Y2goZS5jb2RlKXtcclxuICAgICAgICBjYXNlICdLZXlXJzpcclxuICAgICAgICAgICAga2V5UHJlc3MuVyA9IGZhbHNlO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0tleUEnOlxyXG4gICAgICAgICAgICBrZXlQcmVzcy5BID0gZmFsc2U7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnS2V5Uyc6XHJcbiAgICAgICAgICAgIGtleVByZXNzLlMgPSBmYWxzZTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdLZXlEJzpcclxuICAgICAgICAgICAga2V5UHJlc3MuRCA9IGZhbHNlO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0tleVonOlxyXG4gICAgICAgICAgICBrZXlQcmVzcy5aID0gZmFsc2U7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnS2V5WCc6XHJcbiAgICAgICAgICAgIGtleVByZXNzLlggPSBmYWxzZTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlU2hhZGVyKCkge1xyXG4gICAgLy9pbml0IHNreWJveFxyXG4gICAgc2t5Ym94X2NyZWF0ZVNoYWRlcigpO1xyXG4gICAgLy9pbml0IGRlcHRoIG1hcFxyXG4gICAgZGVwdGhNYXBfY3JlYXRlU2hhZGVyKCk7XHJcbiAgICAvL2luaXQgbGFuZFxyXG4gICAgbGFuZF9jcmVhdGVTaGFkZXIoKTtcclxuICAgIC8vaW5pdCBzc2FvXHJcbiAgICBzc2FvX2NyZWF0ZVNoYWRlcigpO1xyXG4gICAgLy9pbml0IHRlc3RcclxuICAgIHRlc3RfY3JlYXRlU2hhZGVyKCk7XHJcblxyXG59XHJcblxyXG5mdW5jdGlvbiB0ZXN0X2NyZWF0ZVNoYWRlcigpe1xyXG4gICAgbGV0IHZzU3JjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rlc3QudnMnKS5pbm5lclRleHQudHJpbSgpO1xyXG4gICAgbGV0IGZzU3JjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rlc3QuZnMnKS5pbm5lclRleHQudHJpbSgpO1xyXG5cclxuICAgIHRlc3QucHJvZ3JhbSA9IGNyZWF0ZV9wcm9ncmFtKHZzU3JjLCBmc1NyYyk7XHJcblxyXG4gICAgdGVzdC51X3AgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24odGVzdC5wcm9ncmFtLCAnc3Nhb191bTRwJyk7XHJcbiAgICB0ZXN0LnVfbm9pc2Vfc2NhbGUgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24odGVzdC5wcm9ncmFtLCBcIm5vaXNlX3NjYWxlXCIpO1xyXG5cclxuICAgIHRlc3QuZmJvID0gZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTtcclxuICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgdGVzdC5mYm8pO1xyXG5cclxuICAgIHRlc3QuYW9fdGV4ID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGVzdC5hb190ZXgpO1xyXG4gICAgZ2wudGV4U3RvcmFnZTJEKGdsLlRFWFRVUkVfMkQsIDEsIGdsLlJHQkE4LCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5ORUFSRVNUKTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5ORUFSRVNUKTtcclxuXHJcbiAgICB2YXIgZGVwID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgZGVwKTtcclxuICAgIGdsLnRleFN0b3JhZ2UyRChnbC5URVhUVVJFXzJELCAxLCBnbC5ERVBUSF9DT01QT05FTlQzMkYsIHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpO1xyXG5cdGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9DT01QQVJFX01PREUsIGdsLkNPTVBBUkVfUkVGX1RPX1RFWFRVUkUpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX0NPTVBBUkVfRlVOQywgZ2wuTEVRVUFMKTtcclxuICAgIFxyXG4gICAgZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoZ2wuRlJBTUVCVUZGRVIsIGdsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbC5URVhUVVJFXzJELCB0ZXN0LmFvX3RleCwgMCk7XHJcbiAgICBnbC5mcmFtZWJ1ZmZlclRleHR1cmUyRChnbC5GUkFNRUJVRkZFUiwgZ2wuREVQVEhfQVRUQUNITUVOVCwgZ2wuVEVYVFVSRV8yRCwgZGVwLCAwKTtcclxuICAgIFxyXG4gICAgdGVzdC52YW8gPSBnbC5jcmVhdGVWZXJ0ZXhBcnJheSgpO1xyXG4gICAgZ2wuYmluZFZlcnRleEFycmF5KHRlc3QudmFvKTtcclxuXHJcbiAgICB0ZXN0Lmtlcm5lbF91Ym8gPSBnbC5jcmVhdGVCdWZmZXIoKTtcclxuICAgIGdsLmJpbmRCdWZmZXIoZ2wuVU5JRk9STV9CVUZGRVIsIHRlc3Qua2VybmVsX3Vibyk7XHJcbiAgICBsZXQga2VybmVscyA9IG5ldyBGbG9hdDMyQXJyYXkoMTI4KTtcclxuICAgIGxldCB0bXAgPSBnbG0udmVjMy5jcmVhdGUoKTtcclxuICAgIGxldCBvdXQgPSBnbG0udmVjMy5jcmVhdGUoKTtcclxuXHRmb3IgKGxldCBpID0gMDsgaSA8IDMyOyBpKyspXHJcblx0e1xyXG5cdFx0Z2xtLnZlYzMubm9ybWFsaXplKHRtcCAsZ2xtLnZlYzMuZnJvbVZhbHVlcyhcclxuXHRcdFx0TWF0aC5yYW5kb20oKSAqIDIgLSAxLFxyXG5cdFx0XHRNYXRoLnJhbmRvbSgpICogMiAtIDEsXHJcblx0XHRcdE1hdGgucmFuZG9tKCkgKiAwLjg1ICsgMC4xNVxyXG4gICAgICAgICkpO1xyXG4gICAgICAgIGxldCBzY2EgPSBpIC8gMzI7XHJcbiAgICAgICAgc2NhID0gMC4xICsgMC45ICogc2NhICogc2NhO1xyXG4gICAgICAgIGdsbS52ZWMzLm11bChvdXQsIHRtcCwgZ2xtLnZlYzMuZnJvbVZhbHVlcyhzY2EsIHNjYSwgc2NhKSk7XHJcbiAgICAgICAga2VybmVsc1s0KmldID0gICB0bXBbMF0gKiBzY2E7Ly9vdXRbMF07XHJcbiAgICAgICAga2VybmVsc1s0KmkrMV0gPSB0bXBbMV0gKiBzY2E7Ly9vdXRbMV07XHJcbiAgICAgICAga2VybmVsc1s0KmkrMl0gPSB0bXBbMl0gKiBzY2E7Ly9vdXRbMl07XHJcbiAgICAgICAga2VybmVsc1s0KmkrM10gPSAwO1xyXG4gICAgfVxyXG4gICAgZ2wuYnVmZmVyRGF0YShnbC5VTklGT1JNX0JVRkZFUiwga2VybmVscywgZ2wuU1RBVElDX0RSQVcpO1xyXG5cclxuICAgIGxldCB0MCA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbih0ZXN0LnByb2dyYW0sICdnRGVwdGhfdGV4Jyk7XHJcbiAgICBsZXQgdDEgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24odGVzdC5wcm9ncmFtLCAnZ05vcm1fdGV4Jyk7XHJcbiAgICBsZXQgdDIgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24odGVzdC5wcm9ncmFtLCAnZ05vaXNlJyk7XHJcblxyXG4gICAgZ2wudXNlUHJvZ3JhbSh0ZXN0LnByb2dyYW0pO1xyXG4gICAgZ2wudW5pZm9ybTFpKHQwLCAwKTtcclxuICAgIGdsLnVuaWZvcm0xaSh0MSwgMSk7XHJcbiAgICBnbC51bmlmb3JtMWkodDIsIDIpO1xyXG5cclxuICAgIGxldCBibG9ja0lkeCA9IGdsLmdldFVuaWZvcm1CbG9ja0luZGV4KHRlc3QucHJvZ3JhbSwgXCJLZXJuYWxzXCIpO1xyXG4gICAgZ2wudW5pZm9ybUJsb2NrQmluZGluZyh0ZXN0LnByb2dyYW0sIGJsb2NrSWR4LCAwKTtcclxuICAgIFxyXG4gICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBudWxsKTtcclxuXHJcblxyXG5cclxufVxyXG5cclxuZnVuY3Rpb24gc3Nhb19jcmVhdGVTaGFkZXIoKXtcclxuICAgIGxldCB2c1NyYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzc2FvLnZzJykuaW5uZXJUZXh0LnRyaW0oKTtcclxuICAgIGxldCBmc1NyYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzc2FvLmZzJykuaW5uZXJUZXh0LnRyaW0oKTtcclxuXHJcbiAgICBzc2FvLnByb2dyYW0gPSBjcmVhdGVfcHJvZ3JhbSh2c1NyYywgZnNTcmMpO1xyXG5cclxuICAgIHNzYW8udV90cmFucyA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihzc2FvLnByb2dyYW0sICd0cmFucycpO1xyXG4gICAgc3Nhby51X3YgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oc3Nhby5wcm9ncmFtLCAndW00dicpO1xyXG4gICAgc3Nhby51X3AgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oc3Nhby5wcm9ncmFtLCAndW00cCcpO1xyXG4gICAgc3Nhby51X29mZnNldCA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihzc2FvLnByb2dyYW0sICdvZmZzZXQnKTtcclxuICAgIHNzYW8uZmJvID0gZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTtcclxuICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgc3Nhby5mYm8pO1xyXG4gICAgXHJcbiAgICBzc2FvLm5vcm1fdGV4ID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgc3Nhby5ub3JtX3RleCk7XHJcbiAgICBnbC50ZXhTdG9yYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMSwgZ2wuUkdCQTgsIHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLk5FQVJFU1QpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLk5FQVJFU1QpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfUywgZ2wuQ0xBTVBfVE9fRURHRSk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5DTEFNUF9UT19FREdFKTtcclxuXHJcblxyXG4gICAgc3Nhby5kZXB0aF90ZXggPSBnbC5jcmVhdGVUZXh0dXJlKCk7XHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBzc2FvLmRlcHRoX3RleCk7XHJcbiAgICBnbC50ZXhTdG9yYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMSwgZ2wuREVQVEhfQ09NUE9ORU5UMzJGLCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTtcclxuXHJcbiAgICAvLyBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfQ09NUEFSRV9NT0RFLCBnbC5DT01QQVJFX1JFRl9UT19URVhUVVJFKTtcclxuXHQvLyBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfQ09NUEFSRV9GVU5DLCBnbC5MRVFVQUwpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLk5FQVJFU1QpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLk5FQVJFU1QpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfUywgZ2wuQ0xBTVBfVE9fRURHRSk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5DTEFNUF9UT19FREdFKTtcclxuXHJcbiAgICBnbC5mcmFtZWJ1ZmZlclRleHR1cmUyRChnbC5GUkFNRUJVRkZFUiwgZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsLlRFWFRVUkVfMkQsIHNzYW8ubm9ybV90ZXgsIDApO1xyXG4gICAgZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoZ2wuRlJBTUVCVUZGRVIsIGdsLkRFUFRIX0FUVEFDSE1FTlQsIGdsLlRFWFRVUkVfMkQsIHNzYW8uZGVwdGhfdGV4LCAwKTtcclxuXHJcbiAgICBcdC8vIG5vaXNlIG1hcFxyXG5cdHNzYW8ubm9pc2VfbWFwID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgc3Nhby5ub2lzZV9tYXApO1xyXG5cclxuICAgIGxldCBub2lzZURhdGEgPSBuZXcgRmxvYXQzMkFycmF5KDQ4KTtcclxuICAgIGxldCBvdXQgPSBnbG0udmVjMy5jcmVhdGUoKTtcclxuXHRmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpKyspXHJcblx0e1xyXG5cdFx0Z2xtLnZlYzMubm9ybWFsaXplKG91dCAsZ2xtLnZlYzMuZnJvbVZhbHVlcyhcclxuXHRcdFx0TWF0aC5yYW5kb20oKSwgLy8gMC4wIH4gMS4wXHJcblx0XHRcdE1hdGgucmFuZG9tKCksIC8vIDAuMCB+IDEuMFxyXG5cdFx0XHQwLjBcclxuICAgICAgICApKTtcclxuICAgICAgICBub2lzZURhdGFbMyppXSA9IG91dFswXTtcclxuICAgICAgICBub2lzZURhdGFbMyppKzFdID0gb3V0WzFdO1xyXG4gICAgICAgIG5vaXNlRGF0YVszKmkrMl0gPSBvdXRbMl07XHJcblx0fVxyXG4gICAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBnbC5SR0IzMkYsIDQsIDQsIDAsIGdsLlJHQiwgZ2wuRkxPQVQsIG5vaXNlRGF0YSk7XHJcblx0Z2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLk5FQVJFU1QpO1xyXG5cdGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5ORUFSRVNUKTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIGdsLlJFUEVBVCk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5SRVBFQVQpO1xyXG5cdC8vLy9cclxuXHRnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIG51bGwpO1xyXG5cclxufVxyXG5cclxuZnVuY3Rpb24gZGVwdGhNYXBfY3JlYXRlU2hhZGVyKCl7XHJcbiAgICBsZXQgdnNTcmMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVwdGgudnMnKS5pbm5lclRleHQudHJpbSgpO1xyXG4gICAgbGV0IGZzU3JjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlcHRoLmZzJykuaW5uZXJUZXh0LnRyaW0oKTtcclxuXHJcbiAgICBkZXB0aC5wcm9ncmFtID0gY3JlYXRlX3Byb2dyYW0odnNTcmMsIGZzU3JjKTtcclxuICAgIC8vdW5pZm9ybSB0b2RvXHJcbiAgICBkZXB0aC51X3RyYW5zID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGRlcHRoLnByb2dyYW0sICd0cmFucycpO1xyXG4gICAgZGVwdGgudV92cCA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihkZXB0aC5wcm9ncmFtLCAndW00dnAnKTtcclxuICAgIGRlcHRoLnVfb2Zmc2V0ID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGRlcHRoLnByb2dyYW0sICdvZmZzZXQnKTtcclxuXHJcbiAgICAvL2luaXQgdGV4XHJcbiAgICBkZXB0aC5mYm8gPSBnbC5jcmVhdGVGcmFtZWJ1ZmZlcigpO1xyXG4gICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBkZXB0aC5mYm8pO1xyXG4gICAgZGVwdGgudGV4ID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgZGVwdGgudGV4KTtcclxuICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuREVQVEhfQ09NUE9ORU5UMzJGLCBkZXB0aF9zaXplLCBkZXB0aF9zaXplLCAwLFxyXG4gICAgICAgIGdsLkRFUFRIX0NPTVBPTkVOVCwgZ2wuRkxPQVQsIG51bGwpO1xyXG4gICAgXHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUlOX0ZJTFRFUiwgZ2wuTElORUFSKTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5MSU5FQVIpO1xyXG5cdGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9DT01QQVJFX01PREUsIGdsLkNPTVBBUkVfUkVGX1RPX1RFWFRVUkUpO1xyXG5cdGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9DT01QQVJFX0ZVTkMsIGdsLkxFUVVBTCk7XHJcbiAgICBnbC5mcmFtZWJ1ZmZlclRleHR1cmUyRChnbC5GUkFNRUJVRkZFUiwgZ2wuREVQVEhfQVRUQUNITUVOVCwgZ2wuVEVYVFVSRV8yRCwgZGVwdGgudGV4LCAwKTtcclxuICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbCk7XHJcblxyXG4gICAgbGV0IHJhbmdlID0gMTUwO1xyXG4gICAgbGV0IGxpZ2h0X3AgPSBnbG0ubWF0NC5jcmVhdGUoKTtcclxuICAgIGdsbS5tYXQ0Lm9ydGhvKGxpZ2h0X3AsIC1yYW5nZSwgcmFuZ2UsIC1yYW5nZSwgcmFuZ2UsIDAsIDUwMCk7XHJcbiAgICBsZXQgbGlnaHRfdiA9IGdsbS5tYXQ0LmNyZWF0ZSgpO1xyXG4gICAgZ2xtLm1hdDQubG9va0F0KGxpZ2h0X3YsIGxpZ2h0X3BvcywgZ2xtLnZlYzMuZnJvbVZhbHVlcygwLCAwLCAwKSxcclxuICAgICAgICBnbG0udmVjMy5mcm9tVmFsdWVzKDAsIDEsIDApKTtcclxuICAgIGdsbS5tYXQ0Lm11bHRpcGx5KGxpZ2h0dnAsIGxpZ2h0X3AsIGxpZ2h0X3YpO1xyXG5cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIGxhbmRfY3JlYXRlU2hhZGVyKCl7XHJcbiAgICAvLyBnZXQgc2hhZGVyIHN0cmluZ1xyXG4gICAgbGV0IHZzU3JjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xhbmQudnMnKS5pbm5lclRleHQudHJpbSgpO1xyXG4gICAgbGV0IGZzU3JjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xhbmQuZnMnKS5pbm5lclRleHQudHJpbSgpO1xyXG5cclxuICAgIGxhbmQubGFuZFByb2cgPSBjcmVhdGVfcHJvZ3JhbSh2c1NyYywgZnNTcmMpO1xyXG4gICAgLy91bmlmb3JtIHRvZG9cclxuICAgIGxhbmQudV92ID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGxhbmQubGFuZFByb2csICd1bTR2Jyk7XHJcbiAgICBsYW5kLnVfcCA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihsYW5kLmxhbmRQcm9nLCAndW00cCcpO1xyXG4gICAgbGFuZC51X3RyYW5zID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGxhbmQubGFuZFByb2csICd0cmFucycpO1xyXG4gICAgbGFuZC51X2V5ZXBvcz0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGxhbmQubGFuZFByb2csICdleWVwb3MnKTtcclxuICAgIGxhbmQudV9saWdodF9wb3M9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihsYW5kLmxhbmRQcm9nLCAnbGlnaHRfcG9zJyk7XHJcbiAgICBsYW5kLnVfc2hhZG93X21hdHJpeD0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGxhbmQubGFuZFByb2csICdzaGFkb3dfbWF0cml4Jyk7XHJcbiAgICBsYW5kLnVfb2Zmc2V0PSBnbC5nZXRVbmlmb3JtTG9jYXRpb24obGFuZC5sYW5kUHJvZywgJ29mZnNldCcpO1xyXG4gICAgbGFuZC51X2lzTj0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGxhbmQubGFuZFByb2csICdpc04nKTtcclxuICAgIGxhbmQudV9pc1NIPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24obGFuZC5sYW5kUHJvZywgJ2lzU0gnKTtcclxuICAgIGxhbmQudV9pc1NzYW89IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihsYW5kLmxhbmRQcm9nLCAnaXNTc2FvJyk7XHJcbiAgICBsZXQgdDAgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24obGFuZC5sYW5kUHJvZywgJ3RleCcpO1xyXG4gICAgbGV0IHQxID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGxhbmQubGFuZFByb2csICdzYW5kX3RleCcpO1xyXG4gICAgbGV0IHQyID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGxhbmQubGFuZFByb2csICd0ZXhfbm9ybScpO1xyXG4gICAgbGV0IHQzID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKGxhbmQubGFuZFByb2csICdzYW5kX3RleF9ub3JtJyk7XHJcbiAgICBsZXQgdDQgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24obGFuZC5sYW5kUHJvZywgJ3NoYWRvd190ZXgnKTtcclxuICAgIGxldCB0NSA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihsYW5kLmxhbmRQcm9nLCAnYW9fdGV4Jyk7XHJcbiAgICBnbC51c2VQcm9ncmFtKGxhbmQubGFuZFByb2cpO1xyXG4gICAgZ2wudW5pZm9ybTFpKGxhbmQudV9pc04sIGZsYWcubm9ybWFsKTtcclxuICAgIGdsLnVuaWZvcm0xaShsYW5kLnVfaXNTSCwgZmxhZy5zaGFkb3cpO1xyXG4gICAgZ2wudW5pZm9ybTFpKGxhbmQudV9pc1NzYW8sIGZsYWcuc3Nhbyk7XHJcblxyXG4gICAgZ2wudW5pZm9ybTFpKHQwLCAwKTtcclxuICAgIGdsLnVuaWZvcm0xaSh0MSwgMSk7XHJcbiAgICBnbC51bmlmb3JtMWkodDIsIDIpO1xyXG4gICAgZ2wudW5pZm9ybTFpKHQzLCAzKTtcclxuICAgIGdsLnVuaWZvcm0xaSh0NCwgNCk7XHJcbiAgICBnbC51bmlmb3JtMWkodDUsIDUpO1xyXG5cclxuICAgIGxhbmQudHJhbnMgPSBnbG0ubWF0NC5jcmVhdGUoKTtcclxuICAgIGxhbmQuc2hhZG93X21hdHJpeCA9IGdsbS5tYXQ0LmNyZWF0ZSgpO1xyXG4gICAgLy9zaGFkb3cgbWF0cml4XHJcbiAgICBnbG0ubWF0NC5mcm9tVHJhbnNsYXRpb24obGFuZC5zaGFkb3dfbWF0cml4LCBnbG0udmVjMy5mcm9tVmFsdWVzKDAuNSwgMC41LCAwLjUpKTtcclxuICAgIGdsbS5tYXQ0LnNjYWxlKGxhbmQuc2hhZG93X21hdHJpeCwgbGFuZC5zaGFkb3dfbWF0cml4LCBnbG0udmVjMy5mcm9tVmFsdWVzKDAuNSwgMC41LCAwLjUpKTtcclxuICAgIGdsbS5tYXQ0Lm11bHRpcGx5KGxhbmQuc2hhZG93X21hdHJpeCxsYW5kLnNoYWRvd19tYXRyaXgsbGlnaHR2cCk7XHJcblxyXG4gICAgZ2wudW5pZm9ybTNmdihsYW5kLnVfZXllcG9zLCB0cmFja2JhbGwuY2FtUG9zKTtcclxuICAgIGdsLnVuaWZvcm0zZnYobGFuZC51X2xpZ2h0X3BvcywgbGlnaHRfcG9zKTtcclxuICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYobGFuZC51X3NoYWRvd19tYXRyaXgsIGZhbHNlLCBsYW5kLnNoYWRvd19tYXRyaXgpOy8vdG9kb1xyXG5cclxuICAgIC8vZ2VuZXJhdGUgbWFwIFxyXG4gICAgbGFuZC5kYXRhLmxlbmd0aCA9IHdvcmxkV2lkdGggKiB3b3JsZERlcHRoO1xyXG4gICAgbGFuZC5vZmZzZXQgPSBuZXcgRmxvYXQzMkFycmF5KCB3b3JsZFdpZHRoICogd29ybGREZXB0aCAqIDMpO1xyXG4gICAgbGFuZF9nZW5IZWlnaHQoKTtcclxuICAgIGxhbmRfZ2VuTWFwKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGxhbmRfZ2VuSGVpZ2h0KCl7XHJcblx0bGV0XHRzaXplID0gd29ybGRXaWR0aCAqIHdvcmxkRGVwdGg7XHJcblx0XHJcbiAgICBsZXRcdHF1YWxpdHkgPSAyO1xyXG5cdGxldCB6ID0gTWF0aC5yYW5kb20oKSAqIDEwMDtcclxuXHJcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IDQ7IGorKykge1xyXG5cclxuXHRcdGlmIChqID09IDApIFxyXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkrKykgbGFuZC5kYXRhW2ldID0gMDtcclxuXHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkrKykge1xyXG5cclxuXHRcdFx0bGV0IHggPSBpICUgd29ybGRXaWR0aCwgeSA9IChpIC8gd29ybGRXaWR0aCkgfCAwO1xyXG5cdFx0XHRsYW5kLmRhdGFbaV0gKz0gcGVybGluLm5vaXNlKHggLyBxdWFsaXR5LCB5IC8gcXVhbGl0eSwgeikgKiBxdWFsaXR5O1xyXG5cdFx0fVxyXG5cclxuXHRcdHF1YWxpdHkgKj0gNDtcclxuXHJcblx0fVxyXG5cclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0WSh4LCB6KXtcclxuXHRyZXR1cm4gTWF0aC5mbG9vciggbGFuZC5kYXRhW3ggKyB6ICogd29ybGRXaWR0aF0gKiAwLjIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBsYW5kX2dlbk1hcCgpe1xyXG4gICAgY29uc29sZS5sb2coXCJsYW5kX2dlbk1hcFwiKTtcclxuICAgIGxldCBpID0gMDtcclxuICAgIGxldCBtYXggPSAwO1xyXG4gICAgbGV0IG1pbiA9IEluZmluaXR5O1xyXG5cclxuXHRmb3IgKGxldCB6ID0gMDsgeiA8IHdvcmxkRGVwdGg7IHorKykge1xyXG5cdFx0Zm9yIChsZXQgeCA9IDA7IHggPCB3b3JsZFdpZHRoOyB4KyspIHtcclxuXHJcblx0XHRcdGxldCBoID0gZ2V0WSh4LCB6KTtcclxuXHRcdFx0aWYgKGggPiBtYXgpIG1heCA9IGg7XHJcblx0XHRcdGlmIChoIDwgbWluKSBtaW4gPSBoO1xyXG4gICAgICAgICAgICAvL3ByaW50ZihcImggPSAlZlxcblwiLCBoKTtcclxuICAgICAgICAgICAgdmFyIG5ld3BvcyA9IGdsbS52ZWMzLmZyb21WYWx1ZXMoXHJcbiAgICAgICAgICAgICAgICB4IC0gd29ybGRIYWxmV2lkdGgsXHJcblx0XHRcdFx0aCxcclxuXHRcdFx0XHR6IC0gd29ybGRIYWxmRGVwdGgpO1xyXG4gICAgICAgICAgICAvLyBsYW5kLm9mZnNldC5wdXNoKG5ld3Bvcyk7XHJcbiAgICAgICAgICAgIGxhbmQub2Zmc2V0W2kgKiAzXSA9IG5ld3Bvc1swXTtcclxuICAgICAgICAgICAgbGFuZC5vZmZzZXRbaSAqIDMgKyAxXSA9IG5ld3Bvc1sxXTtcclxuICAgICAgICAgICAgbGFuZC5vZmZzZXRbaSAqIDMgKyAyXSA9IG5ld3Bvc1syXTtcclxuICAgICAgICAgICAgXHJcblx0XHRcdGkrKztcclxuXHJcblx0XHR9XHJcbiAgICB9XHJcbiAgIFxyXG59XHJcblxyXG5mdW5jdGlvbiBza3lib3hfY3JlYXRlU2hhZGVyKCl7XHJcbiAgICAvLyBnZXQgc2hhZGVyIHN0cmluZ1xyXG4gICAgbGV0IHZzU3JjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NreWJveC52cycpLmlubmVyVGV4dC50cmltKCk7XHJcbiAgICBsZXQgZnNTcmMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2t5Ym94LmZzJykuaW5uZXJUZXh0LnRyaW0oKTtcclxuXHJcbiAgICBza3lib3gucHJvZ3JhbSA9IGNyZWF0ZV9wcm9ncmFtKHZzU3JjLCBmc1NyYyk7XHJcbiAgICBza3lib3gudV9wdm0gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oc2t5Ym94LnByb2dyYW0sICdwdm0nKTtcclxuICAgIFxyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVfcHJvZ3JhbSh2c1NyYyxmc1NyYyl7XHJcbiAgICAvLyBjcmVhdGUgdmVydGV4IHNoYWRlclxyXG4gICAgbGV0IHZzID0gZ2wuY3JlYXRlU2hhZGVyKGdsLlZFUlRFWF9TSEFERVIpO1xyXG4gICAgZ2wuc2hhZGVyU291cmNlKHZzLCB2c1NyYyk7XHJcbiAgICBnbC5jb21waWxlU2hhZGVyKHZzKTtcclxuXHJcbiAgICBpZiAoIWdsLmdldFNoYWRlclBhcmFtZXRlcih2cywgZ2wuQ09NUElMRV9TVEFUVVMpKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihnbC5nZXRTaGFkZXJJbmZvTG9nKHZzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gY3JlYXRlIGZyYWdtZW50IHNoYWRlclxyXG4gICAgbGV0IGZzID0gZ2wuY3JlYXRlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUik7XHJcbiAgICBnbC5zaGFkZXJTb3VyY2UoZnMsIGZzU3JjKTtcclxuICAgIGdsLmNvbXBpbGVTaGFkZXIoZnMpO1xyXG5cclxuICAgIGlmICghZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKGZzLCBnbC5DT01QSUxFX1NUQVRVUykpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGdsLmdldFNoYWRlckluZm9Mb2coZnMpKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBjcmVhdGUgc2hhZGVyIHByb2dyYW1cclxuICAgIGxldCBwcm9nID0gZ2wuY3JlYXRlUHJvZ3JhbSgpO1xyXG4gICAgZ2wuYXR0YWNoU2hhZGVyKHByb2csIHZzKTtcclxuICAgIGdsLmF0dGFjaFNoYWRlcihwcm9nLCBmcyk7XHJcbiAgICBnbC5saW5rUHJvZ3JhbShwcm9nKTtcclxuXHJcbiAgICBpZiAoIWdsLmdldFByb2dyYW1QYXJhbWV0ZXIocHJvZywgZ2wuTElOS19TVEFUVVMpKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihnbC5nZXRQcm9ncmFtSW5mb0xvZyhwcm9nKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcHJvZztcclxufVxyXG5cclxuZnVuY3Rpb24gX2xvYWRGaWxlKHVybCkge1xyXG4gICAgbGV0IGZyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgbGV0IHJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgIHJlcS5vcGVuKCdHRVQnLCB1cmwsIHRydWUpO1xyXG4gICAgICAgIHJlcS5yZXNwb25zZVR5cGUgPSAnYmxvYic7XHJcbiAgICAgICAgcmVxLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgZnIucmVhZEFzVGV4dChyZXEucmVzcG9uc2UpO1xyXG4gICAgICAgICAgICBmci5vbmxvYWQgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGYgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICBsZXQgbHMgPSBmLnNwbGl0KC9cXHI/XFxuLyk7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKGxzKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVxLm9uZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoYEZhaWxlZCB0byBsb2FkIGZpbGUncyB1cmw6ICR7dXJsfWApKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJlcS5zZW5kKCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gbG9hZE9iaih1cmwpIHtcclxuICAgIC8vIHJlYWQgZmlsZVxyXG4gICAgbGV0IGxpbmVzID0gYXdhaXQgX2xvYWRGaWxlKHVybCk7XHJcblxyXG4gICAgLy8gcGFyc2Ugb2JqIGZvcm1hdFxyXG4gICAgbGV0IHYgPSBbXTtcclxuICAgIGxldCB2dCA9IFtdO1xyXG4gICAgbGV0IHZuID0gW107XHJcbiAgICBsZXQgaWR4ID0gW107XHJcblxyXG4gICAgZm9yIChsZXQgbGluZSBvZiBsaW5lcykge1xyXG4gICAgICAgIGxpbmUgPSBsaW5lLnNwbGl0KCcgJyk7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2cobGluZSk7XHJcbiAgICAgICAgaWYgKGxpbmVbMF0gPT0gJ3YnKSB7XHJcbiAgICAgICAgICAgIHYucHVzaChwYXJzZUZsb2F0KGxpbmVbMV0pKTtcclxuICAgICAgICAgICAgdi5wdXNoKHBhcnNlRmxvYXQobGluZVsyXSkpO1xyXG4gICAgICAgICAgICB2LnB1c2gocGFyc2VGbG9hdChsaW5lWzNdKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGxpbmVbMF0gPT0gJ3ZuJykge1xyXG4gICAgICAgICAgICB2bi5wdXNoKHBhcnNlRmxvYXQobGluZVsxXSkpO1xyXG4gICAgICAgICAgICB2bi5wdXNoKHBhcnNlRmxvYXQobGluZVsyXSkpO1xyXG4gICAgICAgICAgICB2bi5wdXNoKHBhcnNlRmxvYXQobGluZVszXSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChsaW5lWzBdID09ICd2dCcpIHtcclxuICAgICAgICAgICAgdnQucHVzaChwYXJzZUZsb2F0KGxpbmVbMV0pKTtcclxuICAgICAgICAgICAgLy8gZmxpcCB2ZXJ0aWNhbGx5XHJcbiAgICAgICAgICAgIHZ0LnB1c2goMS4wIC0gcGFyc2VGbG9hdChsaW5lWzJdKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGxpbmVbMF0gPT0gJ2YnKSB7XHJcbiAgICAgICAgICAgIC8vIHN0YXJ0IGZyb20gemVyb1xyXG4gICAgICAgICAgICBpZHgucHVzaChwYXJzZUludChsaW5lWzFdLnNwbGl0KCcvJylbMF0pIC0gMSk7XHJcbiAgICAgICAgICAgIGlkeC5wdXNoKHBhcnNlSW50KGxpbmVbMl0uc3BsaXQoJy8nKVswXSkgLSAxKTtcclxuICAgICAgICAgICAgaWR4LnB1c2gocGFyc2VJbnQobGluZVszXS5zcGxpdCgnLycpWzBdKSAtIDEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBjb21wdXRlIHRhbmdlbnRcclxuICAgIGxldCB0biA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpZHgubGVuZ3RoOyBpKz0zKSB7XHJcbiAgICAgICAgbGV0IGlkeDEgPSBpZHhbaV07XHJcbiAgICAgICAgbGV0IGlkeDIgPSBpZHhbaSArIDFdO1xyXG4gICAgICAgIGxldCBpZHgzID0gaWR4W2kgKyAyXTtcclxuXHJcbiAgICAgICAgbGV0IHAxID0gZ2xtLnZlYzMuZnJvbVZhbHVlcyh2W2lkeDEgKiAzICsgMF0sIHZbaWR4MSAqIDMgKyAxXSwgdltpZHgxICogMyArIDJdKTtcclxuICAgICAgICBsZXQgcDIgPSBnbG0udmVjMy5mcm9tVmFsdWVzKHZbaWR4MiAqIDMgKyAwXSwgdltpZHgyICogMyArIDFdLCB2W2lkeDIgKiAzICsgMl0pO1xyXG4gICAgICAgIGxldCBwMyA9IGdsbS52ZWMzLmZyb21WYWx1ZXModltpZHgzICogMyArIDBdLCB2W2lkeDMgKiAzICsgMV0sIHZbaWR4MyAqIDMgKyAyXSk7XHJcblxyXG4gICAgICAgIGxldCBuMSA9IGdsbS52ZWMzLmZyb21WYWx1ZXModm5baWR4MSAqIDMgKyAwXSwgdm5baWR4MSAqIDMgKyAxXSwgdm5baWR4MSAqIDMgKyAyXSk7XHJcbiAgICAgICAgbGV0IG4yID0gZ2xtLnZlYzMuZnJvbVZhbHVlcyh2bltpZHgyICogMyArIDBdLCB2bltpZHgyICogMyArIDFdLCB2bltpZHgyICogMyArIDJdKTtcclxuICAgICAgICBsZXQgbjMgPSBnbG0udmVjMy5mcm9tVmFsdWVzKHZuW2lkeDMgKiAzICsgMF0sIHZuW2lkeDMgKiAzICsgMV0sIHZuW2lkeDMgKiAzICsgMl0pO1xyXG5cclxuICAgICAgICBsZXQgdXYxID0gZ2xtLnZlYzIuZnJvbVZhbHVlcyh2dFtpZHgxICogMiArIDBdLCB2dFtpZHgxICogMiArIDFdKTtcclxuICAgICAgICBsZXQgdXYyID0gZ2xtLnZlYzIuZnJvbVZhbHVlcyh2dFtpZHgyICogMiArIDBdLCB2dFtpZHgyICogMiArIDFdKTtcclxuICAgICAgICBsZXQgdXYzID0gZ2xtLnZlYzIuZnJvbVZhbHVlcyh2dFtpZHgzICogMiArIDBdLCB2dFtpZHgzICogMiArIDFdKTtcclxuXHJcbiAgICAgICAgbGV0IGRwMSA9IGdsbS52ZWMzLmNyZWF0ZSgpOyBnbG0udmVjMy5zdWIoZHAxLCBwMiwgcDEpO1xyXG4gICAgICAgIGxldCBkcDIgPSBnbG0udmVjMy5jcmVhdGUoKTsgZ2xtLnZlYzMuc3ViKGRwMiwgcDMsIHAxKTtcclxuXHJcbiAgICAgICAgbGV0IGR1djEgPSBnbG0udmVjMi5jcmVhdGUoKTsgZ2xtLnZlYzIuc3ViKGR1djEsIHV2MiwgdXYxKTtcclxuICAgICAgICBsZXQgZHV2MiA9IGdsbS52ZWMyLmNyZWF0ZSgpOyBnbG0udmVjMi5zdWIoZHV2MiwgdXYzLCB1djEpO1xyXG5cclxuICAgICAgICBsZXQgciA9IDEuMCAvIChkdXYxWzBdICogZHV2MlsxXSAtIGR1djFbMV0gKiBkdXYyWzBdKTtcclxuXHJcbiAgICAgICAgbGV0IHQgPSBnbG0udmVjMy5mcm9tVmFsdWVzKFxyXG4gICAgICAgICAgICAoZHAxWzBdICogZHV2MlsxXSAtIGRwMlswXSAqIGR1djFbMV0pICogcixcclxuICAgICAgICAgICAgKGRwMVsxXSAqIGR1djJbMV0gLSBkcDJbMV0gKiBkdXYxWzFdKSAqIHIsXHJcbiAgICAgICAgICAgIChkcDFbMl0gKiBkdXYyWzFdIC0gZHAyWzJdICogZHV2MVsxXSkgKiByXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgbGV0IHQxID0gZ2xtLnZlYzMuY3JlYXRlKCk7IGdsbS52ZWMzLmNyb3NzKHQxLCBuMSwgdCk7XHJcbiAgICAgICAgbGV0IHQyID0gZ2xtLnZlYzMuY3JlYXRlKCk7IGdsbS52ZWMzLmNyb3NzKHQyLCBuMiwgdCk7XHJcbiAgICAgICAgbGV0IHQzID0gZ2xtLnZlYzMuY3JlYXRlKCk7IGdsbS52ZWMzLmNyb3NzKHQzLCBuMywgdCk7XHJcblxyXG4gICAgICAgIHRuW2lkeDEgKiAzICsgMF0gPSB0MVswXTtcclxuICAgICAgICB0bltpZHgxICogMyArIDFdID0gdDFbMV07XHJcbiAgICAgICAgdG5baWR4MSAqIDMgKyAyXSA9IHQxWzJdO1xyXG5cclxuICAgICAgICB0bltpZHgyICogMyArIDBdID0gdDJbMF07XHJcbiAgICAgICAgdG5baWR4MiAqIDMgKyAxXSA9IHQyWzFdO1xyXG4gICAgICAgIHRuW2lkeDIgKiAzICsgMl0gPSB0MlsyXTtcclxuXHJcbiAgICAgICAgdG5baWR4MyAqIDMgKyAwXSA9IHQzWzBdO1xyXG4gICAgICAgIHRuW2lkeDMgKiAzICsgMV0gPSB0M1sxXTtcclxuICAgICAgICB0bltpZHgzICogMyArIDJdID0gdDNbMl07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gc3RhdHNcclxuICAgIGNvbnNvbGUubG9nKGBMb2FkICR7dXJsfTogJHt2Lmxlbmd0aH0gdmVydGljZXMsICR7dnQubGVuZ3RofSB0ZXhjb29yZHMsICR7dm4ubGVuZ3RofSBub3JtYWxzIGAgK1xyXG4gICAgICAgICAgICAgICAgYCR7dG4ubGVuZ3RofSB0YW5nZW50cyAke2lkeC5sZW5ndGggLyAzfSBmYWNlc2ApO1xyXG4gICAgXHJcbiAgICAvLyB2YW9cclxuICAgIGxhbmQudmFvID0gZ2wuY3JlYXRlVmVydGV4QXJyYXkoKTtcclxuICAgIGdsLmJpbmRWZXJ0ZXhBcnJheShsYW5kLnZhbyk7XHJcblxyXG4gICAgLy8gdmJvXHJcbiAgICBsZXQgcG9zaXRpb25zID0gbmV3IEZsb2F0MzJBcnJheSh2KTtcclxuICAgIGxldCBub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheSh2bik7XHJcbiAgICBsZXQgdGV4Y29vcmRzID0gbmV3IEZsb2F0MzJBcnJheSh2dCk7XHJcbiAgICBsZXQgdGFuZ2VudHMgPSBuZXcgRmxvYXQzMkFycmF5KHRuKTtcclxuXHJcbiAgICBsZXQgdmJvID0gZ2wuY3JlYXRlQnVmZmVyKCk7XHJcbiAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdmJvKTtcclxuICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBwb3NpdGlvbnMuYnl0ZUxlbmd0aCArIG5vcm1hbHMuYnl0ZUxlbmd0aCArIHRleGNvb3Jkcy5ieXRlTGVuZ3RoICsgdGFuZ2VudHMuYnl0ZUxlbmd0aCwgZ2wuU1RBVElDX0RSQVcpO1xyXG4gICAgZ2wuYnVmZmVyU3ViRGF0YShnbC5BUlJBWV9CVUZGRVIsIDAsIHBvc2l0aW9ucyk7XHJcbiAgICBnbC5idWZmZXJTdWJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgcG9zaXRpb25zLmJ5dGVMZW5ndGgsIG5vcm1hbHMpO1xyXG4gICAgZ2wuYnVmZmVyU3ViRGF0YShnbC5BUlJBWV9CVUZGRVIsIHBvc2l0aW9ucy5ieXRlTGVuZ3RoICsgbm9ybWFscy5ieXRlTGVuZ3RoLCB0ZXhjb29yZHMpO1xyXG4gICAgZ2wuYnVmZmVyU3ViRGF0YShnbC5BUlJBWV9CVUZGRVIsIHBvc2l0aW9ucy5ieXRlTGVuZ3RoICsgbm9ybWFscy5ieXRlTGVuZ3RoICsgdGV4Y29vcmRzLmJ5dGVMZW5ndGgsIHRhbmdlbnRzKTtcclxuXHJcbiAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKDAsIDMsIGdsLkZMT0FULCBmYWxzZSwgMCwgMCk7XHJcbiAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSgwKTtcclxuICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIoMSwgMywgZ2wuRkxPQVQsIGZhbHNlLCAwLCBwb3NpdGlvbnMuYnl0ZUxlbmd0aCk7XHJcbiAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSgxKTtcclxuICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIoMiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCBwb3NpdGlvbnMuYnl0ZUxlbmd0aCArIG5vcm1hbHMuYnl0ZUxlbmd0aCk7XHJcbiAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSgyKTtcclxuICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIoMywgMywgZ2wuRkxPQVQsIGZhbHNlLCAwLCBwb3NpdGlvbnMuYnl0ZUxlbmd0aCArIG5vcm1hbHMuYnl0ZUxlbmd0aCArIHRleGNvb3Jkcy5ieXRlTGVuZ3RoKTtcclxuICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KDMpO1xyXG5cclxuXHJcbiAgICAvLyBlYm9cclxuICAgIGxldCBpbmRpY2VzICA9IG5ldyBVaW50MzJBcnJheShpZHgpO1xyXG4gICAgbGV0IGVibyA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xyXG4gICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgZWJvKTtcclxuICAgIGdsLmJ1ZmZlckRhdGEoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIGluZGljZXMsIGdsLlNUQVRJQ19EUkFXKTtcclxuICAgIGxhbmQuaW5kZXhDb3VudCA9IGlkeC5sZW5ndGg7XHJcbiAgICBcclxuICAgIC8vIGZyZWUgYXJyYXlcclxuICAgIHYubGVuZ3RoID0gMDtcclxuICAgIHZ0Lmxlbmd0aCA9IDA7XHJcbiAgICB2bi5sZW5ndGggPSAwO1xyXG4gICAgaWR4Lmxlbmd0aCA9IDA7XHJcbiAgICB0bi5sZW5ndGggPSAwO1xyXG5cclxuICAgIGdsLmJpbmRWZXJ0ZXhBcnJheShudWxsKTtcclxuICAgIHJldHVybiB0cnVlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBsb2FkSW1hZ2UodXJsKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGxldCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgICBpbWcub25sb2FkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXNvbHZlKGltZyk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2UncyB1cmw6ICR7dXJsfWApKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaW1nLnNyYyA9IHVybDtcclxuICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAnYW5vbnltb3VzJztcclxuICAgIH0pO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBsb2FkQXNzZXQoKSB7XHJcbiAgICAvLyAvLyBvYmpcclxuICAgIGxldCByZXQgPSBhd2FpdCBsb2FkT2JqKCcuL2Fzc2V0L3BsYW5lLm9iaicpO1xyXG4gICAgXHJcbiAgICAvL2xvYWQgbGFuZCB0ZXh0dXJlIHRvZG9cclxuICAgIGxldCBsYW5kX3Byb21pc2VzID0gW107XHJcbiAgICBsYW5kX3Byb21pc2VzLnB1c2gobG9hZEltYWdlKCcuL2Fzc2V0L2dyYXNzX3NpZGUucG5nJykpOy8vMFxyXG4gICAgbGFuZF9wcm9taXNlcy5wdXNoKGxvYWRJbWFnZSgnLi9hc3NldC9ncmFzc190b3AucG5nJykpOy8vMVxyXG4gICAgbGFuZF9wcm9taXNlcy5wdXNoKGxvYWRJbWFnZSgnLi9hc3NldC9zYW5kLnBuZycpKTsvLzJcclxuICAgIGxhbmRfcHJvbWlzZXMucHVzaChsb2FkSW1hZ2UoJy4vYXNzZXQvZ3Jhc3Nfc2lkZV9uLnBuZycpKTsvLzNcclxuICAgIGxhbmRfcHJvbWlzZXMucHVzaChsb2FkSW1hZ2UoJy4vYXNzZXQvZ3Jhc3NfdG9wX24ucG5nJykpOy8vNFxyXG4gICAgbGFuZF9wcm9taXNlcy5wdXNoKGxvYWRJbWFnZSgnLi9hc3NldC9zYW5kX24ucG5nJykpOy8vNVxyXG4gICAgbGV0IGxhbmRfcmVzID0gYXdhaXQgUHJvbWlzZS5hbGwobGFuZF9wcm9taXNlcyk7XHJcbiAgICBmb3IgKGxldCBpPTA7IGk8NjsgaSsrKSB7XHJcbiAgICAgICAgbGFuZC50ZXhbaV0gPSBnbC5jcmVhdGVUZXh0dXJlKCk7XHJcbiAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgbGFuZC50ZXhbaV0pO1xyXG4gICAgICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuUkdCLCBnbC5SR0IsIGdsLlVOU0lHTkVEX0JZVEUsIGxhbmRfcmVzW2ldKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cobGFuZF9yZXNbaV0pO1xyXG4gICAgICAgIGdsLmdlbmVyYXRlTWlwbWFwKGdsLlRFWFRVUkVfMkQpO1xyXG4gICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIGdsLlJFUEVBVCk7Ly9nbC5SRVBFQVRcclxuICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5SRVBFQVQpO1xyXG4gICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5MSU5FQVIpO1xyXG4gICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5MSU5FQVIpO1xyXG4gICAgfVxyXG4gICAgbGFuZF9yZXMubGVuZ3RoID0gMDtcclxuXHJcbiAgICAvL2xvYWQgc2t5Ym94XHJcbiAgICBsZXQgcHJvbWlzZXMgPSBbXTtcclxuICAgIHByb21pc2VzLnB1c2gobG9hZEltYWdlKCcuL2Fzc2V0L2ZhY2Utci5wbmcnKSk7XHJcbiAgICBwcm9taXNlcy5wdXNoKGxvYWRJbWFnZSgnLi9hc3NldC9mYWNlLWwucG5nJykpO1xyXG4gICAgcHJvbWlzZXMucHVzaChsb2FkSW1hZ2UoJy4vYXNzZXQvZmFjZS10LnBuZycpKTtcclxuICAgIHByb21pc2VzLnB1c2gobG9hZEltYWdlKCcuL2Fzc2V0L2ZhY2UtYm90LnBuZycpKTtcclxuICAgIHByb21pc2VzLnB1c2gobG9hZEltYWdlKCcuL2Fzc2V0L2ZhY2UtZnIucG5nJykpO1xyXG4gICAgcHJvbWlzZXMucHVzaChsb2FkSW1hZ2UoJy4vYXNzZXQvZmFjZS1iYS5wbmcnKSk7XHJcbiAgICBsZXQgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcclxuICAgIGxldCBza3lfdGV4ID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV9DVUJFX01BUCwgc2t5X3RleCk7XHJcbiAgICBcclxuICAgIGZvciAobGV0IGk9MDsgaTw2OyBpKyspIHtcclxuICAgICAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIFxyXG4gICAgICAgICAgICAwLCBnbC5SR0JBLHJlc3VsdHNbaV0ud2lkdGgsIHJlc3VsdHNbaV0uaGVpZ2h0LDAsIGdsLlJHQkEsIGdsLlVOU0lHTkVEX0JZVEUsIHJlc3VsdHNbaV0pO1xyXG4gICAgfVxyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFX0NVQkVfTUFQLCBnbC5URVhUVVJFX1dSQVBfUywgZ2wuQ0xBTVBfVE9fRURHRSk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5DTEFNUF9UT19FREdFKTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV9DVUJFX01BUCwgZ2wuVEVYVFVSRV9XUkFQX1IsIGdsLkNMQU1QX1RPX0VER0UpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFX0NVQkVfTUFQLCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLkxJTkVBUik7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2wuTElORUFSKTtcclxuICAgIHNreWJveC52YW8gPSBnbC5jcmVhdGVWZXJ0ZXhBcnJheSgpO1xyXG5cclxuICAgIHJlc3VsdHMubGVuZ3RoID0gMDtcclxuXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbmRlcihkZWx0YSwgdGltZSkge1xyXG4gICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IGdsLkRFUFRIX0JVRkZFUl9CSVQpO1xyXG4gICAgZ2wuY2xlYXJDb2xvcigxLjAsIDEuMCwgMS4wLCAxLjApO1xyXG4gICAgc2t5Ym94X3JlbmRlcigpO1xyXG4gICAgZGVwdGhfcmVuZGVyKCk7XHJcbiAgICBzc2FvX3JlbmRlcigpO1xyXG4gICAgdGVzdF9yZW5kZXIoKTtcclxuICAgIGxhbmRfcmVuZGVyKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRlc3RfcmVuZGVyKCl7XHJcbiAgICBnbC5lbmFibGUoZ2wuREVQVEhfVEVTVCk7XHJcbiAgICBnbC51c2VQcm9ncmFtKHRlc3QucHJvZ3JhbSk7XHJcblxyXG4gICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCB0ZXN0LmZibyk7XHJcbiAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUIHwgZ2wuREVQVEhfQlVGRkVSX0JJVCk7XHJcbiAgICBnbC5kcmF3QnVmZmVycyhbZ2wuQ09MT1JfQVRUQUNITUVOVDBdKTtcclxuXHJcbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTtcclxuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHNzYW8uZGVwdGhfdGV4KTtcclxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTEpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgc3Nhby5ub3JtX3RleCk7XHJcbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUyKTtcclxuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHNzYW8ubm9pc2VfbWFwKTtcclxuXHJcbiAgICBnbC5iaW5kQnVmZmVyQmFzZShnbC5VTklGT1JNX0JVRkZFUiwgMCwgdGVzdC5rZXJuZWxfdWJvKTtcclxuICAgIGdsLnVuaWZvcm0yZnYodGVzdC51X25vaXNlX3NjYWxlLCBnbG0udmVjMi5mcm9tVmFsdWVzKHdpbmRvdy5pbm5lcldpZHRoLzQsIHdpbmRvdy5pbm5lckhlaWdodC80KSk7XHJcbiAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHRlc3QudV9wLCBmYWxzZSwgbWF0cml4LnApO1xyXG5cclxuICAgIGdsLmJpbmRWZXJ0ZXhBcnJheSh0ZXN0LnZhbyk7XHJcbiAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFX1NUUklQLCAwLCA0KTtcclxuXHJcbiAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIG51bGwpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzc2FvX3JlbmRlcigpe1xyXG4gICAgZ2wuZW5hYmxlKGdsLkRFUFRIX1RFU1QpO1xyXG4gICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBzc2FvLmZibyk7XHJcblxyXG4gICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IGdsLkRFUFRIX0JVRkZFUl9CSVQpO1xyXG4gICAgZ2wuZHJhd0J1ZmZlcnMoW2dsLkNPTE9SX0FUVEFDSE1FTlQwXSk7XHJcblxyXG4gICAgZ2wuZW5hYmxlKGdsLlBPTFlHT05fT0ZGU0VUX0ZJTEwpO1xyXG4gICAgLy9nbC5wb2x5Z29uT2Zmc2V0KDQsIDQpO1xyXG5cclxuICAgIGdsLnVzZVByb2dyYW0oc3Nhby5wcm9ncmFtKTtcclxuICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYoc3Nhby51X3YsIGZhbHNlLCBtYXRyaXgudik7XHJcbiAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHNzYW8udV9wLCBmYWxzZSwgbWF0cml4LnApO1xyXG4gICAgcmVuZGVydmFvKCdzc2FvJyk7XHJcbiAgICBnbC5kaXNhYmxlKGdsLlBPTFlHT05fT0ZGU0VUX0ZJTEwpO1xyXG5cclxuICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRlcHRoX3JlbmRlcigpe1xyXG4gICAgZ2wudmlld3BvcnQoMCwgMCwgZGVwdGhfc2l6ZSwgZGVwdGhfc2l6ZSk7XHJcbiAgICBnbC5lbmFibGUoZ2wuREVQVEhfVEVTVCk7XHJcbiAgIFxyXG4gICAgZ2wudXNlUHJvZ3JhbShkZXB0aC5wcm9ncmFtKTtcclxuICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgZGVwdGguZmJvKTtcclxuICAgIFxyXG4gICAgZ2wuY2xlYXIoZ2wuREVQVEhfQlVGRkVSX0JJVCk7XHJcbiAgICBnbC5lbmFibGUoZ2wuUE9MWUdPTl9PRkZTRVRfRklMTCk7XHJcbiAgICBnbC5wb2x5Z29uT2Zmc2V0KDQsIDQpO1xyXG5cclxuICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYoZGVwdGgudV92cCwgZmFsc2UsIGxpZ2h0dnApOy8vdG9kb1xyXG4gICAgcmVuZGVydmFvKCdkZXB0aCcpO1xyXG4gICAgZ2wuZGlzYWJsZShnbC5QT0xZR09OX09GRlNFVF9GSUxMKTtcclxuICAgIGdsLnZpZXdwb3J0KDAsIDAsIGdsLmRyYXdpbmdCdWZmZXJXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7XHJcbiAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIG51bGwpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBsYW5kX3JlbmRlcigpe1xyXG4gICAgLy90b2RvXHJcbiAgICBnbC51c2VQcm9ncmFtKGxhbmQubGFuZFByb2cpO1xyXG4gICAgZ2wudW5pZm9ybU1hdHJpeDRmdihsYW5kLnVfdiwgZmFsc2UsIG1hdHJpeC52KTtcclxuICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYobGFuZC51X3AsIGZhbHNlLCBtYXRyaXgucCk7XHJcblxyXG4gICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7Ly90ZXhfdG9wXHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBsYW5kLnRleFsxXSk7XHJcbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUxKTsvL3RleF9zYW5kXHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBsYW5kLnRleFsyXSk7XHJcbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUyKTsvL3RleF90b3Bfbm9ybVxyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgbGFuZC50ZXhbNF0pO1xyXG4gICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMyk7Ly90ZXhfc2FuZF9ub3JtXHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBsYW5kLnRleFs1XSk7XHJcbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkU0KTsvL3NoYWRvd1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgZGVwdGgudGV4KTtcclxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTUpOy8vYW9fdGVzXHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXN0LmFvX3RleCk7XHJcbiAgICAvL2dsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHNzYW8ubm9pc2VfbWFwKTsgICAgXHJcbiAgICByZW5kZXJ2YW8oJ2xhbmQnKTtcclxuXHJcbn1cclxuZnVuY3Rpb24gZGVnMnJhZCh4KXtcclxuICAgIHJldHVybiB4ICogTWF0aC5QSSAvIDE4MDtcclxufVxyXG5mdW5jdGlvbiByZW5kZXJ2YW8obW9kZSl7XHJcbiAgICBsZXQgc2l6ZSA9IHdvcmxkRGVwdGggKiB3b3JsZFdpZHRoO1xyXG4gICAgZ2wuYmluZFZlcnRleEFycmF5KGxhbmQudmFvKTtcclxuICAgIGxldCByMSA9IGdsbS5tYXQ0LmNyZWF0ZSgpO1xyXG4gICAgZ2xtLm1hdDQuZnJvbVhSb3RhdGlvbihyMSwgZGVnMnJhZCgwKSk7XHJcbiAgICBsZXQgcjIgPSBnbG0ubWF0NC5jcmVhdGUoKTtcclxuICAgIGdsbS5tYXQ0LmZyb21ZUm90YXRpb24ocjIsIGRlZzJyYWQoMCkpO1xyXG4gICAgbGV0IHRyID0gZ2xtLm1hdDQuY3JlYXRlKCk7XHJcbiAgICBnbG0ubWF0NC5mcm9tVHJhbnNsYXRpb24odHIsIGdsbS52ZWMzLmZyb21WYWx1ZXMoMCwgMC41LCAwKSk7XHJcbiAgICBnbG0ubWF0NC5tdWx0aXBseShsYW5kLnRyYW5zLCByMSwgcjIpO1xyXG4gICAgZ2xtLm1hdDQubXVsdGlwbHkobGFuZC50cmFucywgbGFuZC50cmFucywgdHIpO1xyXG4gICAgZm9yKGxldCBqPTA7IGo8NTsgaisrKXtcclxuICAgICAgICBpZihqPT09MSl7Ly9mcm9udFxyXG4gICAgICAgICAgICBpZihtb2RlID09PSAnbGFuZCcpe1xyXG4gICAgICAgICAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7XHJcbiAgICAgICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBsYW5kLnRleFswXSk7XHJcbiAgICAgICAgICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUyKTtcclxuICAgICAgICAgICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIGxhbmQudGV4WzNdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBnbG0ubWF0NC5mcm9tWFJvdGF0aW9uKHIyLCBkZWcycmFkKDkwKSk7XHJcbiAgICAgICAgICAgIGdsbS5tYXQ0LmZyb21ZUm90YXRpb24ocjEsIGRlZzJyYWQoMCkpO1xyXG4gICAgICAgICAgICBnbG0ubWF0NC5mcm9tVHJhbnNsYXRpb24odHIsIGdsbS52ZWMzLmZyb21WYWx1ZXMoMCwgMCwgMC41KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoaj09PTIpey8vbGVmdFxyXG4gICAgICAgICAgICBnbG0ubWF0NC5mcm9tWFJvdGF0aW9uKHIyLCBkZWcycmFkKDkwKSk7XHJcbiAgICAgICAgICAgIGdsbS5tYXQ0LmZyb21ZUm90YXRpb24ocjEsIGRlZzJyYWQoLTkwKSk7XHJcbiAgICAgICAgICAgIGdsbS5tYXQ0LmZyb21UcmFuc2xhdGlvbih0ciwgZ2xtLnZlYzMuZnJvbVZhbHVlcygtMC41LCAwLCAwKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoaj09PTMpey8vYmFja1xyXG4gICAgICAgICAgICBnbG0ubWF0NC5mcm9tWFJvdGF0aW9uKHIyLCBkZWcycmFkKDkwKSk7XHJcbiAgICAgICAgICAgIGdsbS5tYXQ0LmZyb21ZUm90YXRpb24ocjEsIGRlZzJyYWQoMTgwKSk7XHJcbiAgICAgICAgICAgIGdsbS5tYXQ0LmZyb21UcmFuc2xhdGlvbih0ciwgZ2xtLnZlYzMuZnJvbVZhbHVlcygwLCAwLCAtMC41KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoaj09PTQpey8vcmlnaHRcclxuICAgICAgICAgICAgZ2xtLm1hdDQuZnJvbVhSb3RhdGlvbihyMiwgZGVnMnJhZCg5MCkpO1xyXG4gICAgICAgICAgICBnbG0ubWF0NC5mcm9tWVJvdGF0aW9uKHIxLCBkZWcycmFkKDkwKSk7XHJcbiAgICAgICAgICAgIGdsbS5tYXQ0LmZyb21UcmFuc2xhdGlvbih0ciwgZ2xtLnZlYzMuZnJvbVZhbHVlcygwLjUsIDAsIDApKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZ2xtLm1hdDQubXVsdGlwbHkobGFuZC50cmFucywgdHIsIHIxKTtcclxuICAgICAgICBnbG0ubWF0NC5tdWx0aXBseShsYW5kLnRyYW5zLCBsYW5kLnRyYW5zLCByMik7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IG51bSA9IDMwMDtcclxuICAgICAgICBpZihtb2RlID09PSAnbGFuZCcpe1xyXG4gICAgICAgICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KGxhbmQudV90cmFucywgZmFsc2UsIGxhbmQudHJhbnMpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkgKz0gMzAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSArIDMwMCA+IHNpemUpIG51bSA9IHNpemUgLSBpO1xyXG4gICAgICAgICAgICAgICAgZ2wudW5pZm9ybTNmdihsYW5kLnVfb2Zmc2V0LCBsYW5kLm9mZnNldC5zdWJhcnJheShpICogMykpOyAgICAgICBcclxuICAgICAgICAgICAgICAgIGdsLmRyYXdFbGVtZW50c0luc3RhbmNlZChnbC5UUklBTkdMRVMsIGxhbmQuaW5kZXhDb3VudCxcclxuICAgICAgICAgICAgICAgICAgICBnbC5VTlNJR05FRF9JTlQsIDAsIG51bSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZihtb2RlID09PSAnZGVwdGgnKXtcclxuICAgICAgICAgICAgZ2wudW5pZm9ybU1hdHJpeDRmdihkZXB0aC51X3RyYW5zLCBmYWxzZSwgbGFuZC50cmFucyk7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2l6ZTsgaSArPSAzMDApIHtcclxuICAgICAgICAgICAgICAgIGlmIChpICsgMzAwID4gc2l6ZSkgbnVtID0gc2l6ZSAtIGk7XHJcbiAgICAgICAgICAgICAgICBnbC51bmlmb3JtM2Z2KGRlcHRoLnVfb2Zmc2V0LCBsYW5kLm9mZnNldC5zdWJhcnJheShpICogMykpOyAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZ2wuZHJhd0VsZW1lbnRzSW5zdGFuY2VkKGdsLlRSSUFOR0xFUywgbGFuZC5pbmRleENvdW50LFxyXG4gICAgICAgICAgICAgICAgICAgIGdsLlVOU0lHTkVEX0lOVCwgMCwgbnVtKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZihtb2RlID09PSAnc3Nhbycpe1xyXG4gICAgICAgICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHNzYW8udV90cmFucywgZmFsc2UsIGxhbmQudHJhbnMpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkgKz0gMzAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSArIDMwMCA+IHNpemUpIG51bSA9IHNpemUgLSBpO1xyXG4gICAgICAgICAgICAgICAgZ2wudW5pZm9ybTNmdihzc2FvLnVfb2Zmc2V0LCBsYW5kLm9mZnNldC5zdWJhcnJheShpICogMykpOyAgICAgICBcclxuICAgICAgICAgICAgICAgIGdsLmRyYXdFbGVtZW50c0luc3RhbmNlZChnbC5UUklBTkdMRVMsIGxhbmQuaW5kZXhDb3VudCxcclxuICAgICAgICAgICAgICAgICAgICBnbC5VTlNJR05FRF9JTlQsIDAsIG51bSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICBcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc2t5Ym94X3JlbmRlcigpe1xyXG4gICAgZ2wudXNlUHJvZ3JhbShza3lib3gucHJvZ3JhbSk7XHJcblxyXG4gICAgLy8gc2V0IHVuaWZvcm1cclxuICAgIGxldCBwdm0gPSBnbG0ubWF0NC5jcmVhdGUoKTtcclxuICAgIGdsbS5tYXQ0Lm11bHRpcGx5KHB2bSwgbWF0cml4LnAsIG1hdHJpeC52KTtcclxuICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYoc2t5Ym94LnVfcHZtLCBmYWxzZSwgcHZtKTtcclxuXHJcbiAgICAvLyBkcmF3aW5nIGNvbW1hbmRcclxuICAgIGdsLmJpbmRWZXJ0ZXhBcnJheShza3lib3gudmFvKTtcclxuICAgIGdsLmRpc2FibGUoZ2wuREVQVEhfVEVTVCk7XHJcbiAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFX1NUUklQLCAwLCA0KTtcclxuICAgIGdsLmVuYWJsZShnbC5ERVBUSF9URVNUKTtcclxuXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRyYWNrYmFsbF91cGRhdGUodHlwZSl7XHJcbiAgICBsZXQgc3BfdmVjID0gZ2xtLnZlYzMuZnJvbVZhbHVlcyggMCwgdHJhY2tiYWxsLnNwZWVkLCAwKTsvL3VwZG93blxyXG4gICAgbGV0IGZyX3ZlYyA9IGdsbS52ZWMzLmNyZWF0ZSgpOy8vZnJvbnRiYWNrXHJcbiAgICBnbG0udmVjMy5zY2FsZShmcl92ZWMsIHRyYWNrYmFsbC5jYW1Gcm9udCwgdHJhY2tiYWxsLnNwZWVkKTtcclxuICAgIGxldCBscl92ZWMgPSBnbG0udmVjMy5jcmVhdGUoKTsvL2xlZnRyaWdodFxyXG4gICAgZ2xtLnZlYzMubm9ybWFsaXplKGxyX3ZlYywgZ2xtLnZlYzMuY3Jvc3MobHJfdmVjLCB0cmFja2JhbGwuY2FtRnJvbnQsIHRyYWNrYmFsbC5jYW1VcCkpO1xyXG4gICAgZ2xtLnZlYzMuc2NhbGUobHJfdmVjLCBscl92ZWMsIHRyYWNrYmFsbC5zcGVlZCk7XHJcbiAgICBpZih0eXBlID09PSAnVHByZXNzJyl7XHJcbiAgICAgICAgaWYoa2V5UHJlc3MuWiA9PT0gdHJ1ZSkgZ2xtLnZlYzMuYWRkKHRyYWNrYmFsbC5jYW1Qb3MsIHRyYWNrYmFsbC5jYW1Qb3MsIHNwX3ZlYyk7XHJcbiAgICAgICAgaWYoa2V5UHJlc3MuWCA9PT0gdHJ1ZSkgZ2xtLnZlYzMuc3VidHJhY3QodHJhY2tiYWxsLmNhbVBvcywgdHJhY2tiYWxsLmNhbVBvcywgc3BfdmVjKTtcclxuICAgICAgICBpZihrZXlQcmVzcy5XID09PSB0cnVlKSBnbG0udmVjMy5hZGQodHJhY2tiYWxsLmNhbVBvcywgdHJhY2tiYWxsLmNhbVBvcywgZnJfdmVjKTtcclxuICAgICAgICBpZihrZXlQcmVzcy5TID09PSB0cnVlKSBnbG0udmVjMy5zdWJ0cmFjdCh0cmFja2JhbGwuY2FtUG9zLCB0cmFja2JhbGwuY2FtUG9zLCBmcl92ZWMpO1xyXG4gICAgICAgIGlmKGtleVByZXNzLkEgPT09IHRydWUpIGdsbS52ZWMzLnN1YnRyYWN0KHRyYWNrYmFsbC5jYW1Qb3MsIHRyYWNrYmFsbC5jYW1Qb3MsIGxyX3ZlYyk7XHJcbiAgICAgICAgaWYoa2V5UHJlc3MuRCA9PT0gdHJ1ZSkgZ2xtLnZlYzMuYWRkKHRyYWNrYmFsbC5jYW1Qb3MsIHRyYWNrYmFsbC5jYW1Qb3MsIGxyX3ZlYyk7XHJcbiAgICB9XHJcbiAgICBlbHNle1xyXG5cdFx0dHJhY2tiYWxsLmRlZ3JlZV94ID0gbW91c2UuZGlmZl94ICogdHJhY2tiYWxsLnNlbnNpdGl2aXR5O1xyXG5cdFx0dHJhY2tiYWxsLmRlZ3JlZV95ID0gbW91c2UuZGlmZl95ICogdHJhY2tiYWxsLnNlbnNpdGl2aXR5O1xyXG5cdFx0dHJhY2tiYWxsLnhfeWF3ICs9IHRyYWNrYmFsbC5kZWdyZWVfeDtcclxuXHRcdHRyYWNrYmFsbC55X3BpdGNoICs9IHRyYWNrYmFsbC5kZWdyZWVfeTtcclxuXHJcblx0XHRpZiAodHJhY2tiYWxsLnlfcGl0Y2ggPiA4OS4wKVxyXG4gICAgICAgIHRyYWNrYmFsbC55X3BpdGNoID0gODkuMDtcclxuXHRcdGlmICh0cmFja2JhbGwueV9waXRjaCA8IC04OS4wKVxyXG4gICAgICAgIHRyYWNrYmFsbC55X3BpdGNoID0gLTg5LjA7XHJcbiAgICAgICAgbGV0IHggPSBNYXRoLmNvcyhyYWRpYW5zKHRyYWNrYmFsbC55X3BpdGNoKSkgKiBNYXRoLmNvcyhyYWRpYW5zKHRyYWNrYmFsbC54X3lhdykpO1xyXG4gICAgICAgIGxldCB5ID1NYXRoLnNpbihyYWRpYW5zKHRyYWNrYmFsbC55X3BpdGNoKSk7XHJcbiAgICAgICAgbGV0IHogPSAgTWF0aC5jb3MocmFkaWFucyh0cmFja2JhbGwueV9waXRjaCkpICogTWF0aC5zaW4ocmFkaWFucyh0cmFja2JhbGwueF95YXcpKTtcclxuICAgICAgICBnbG0udmVjMy5zZXQodHJhY2tiYWxsLmxmcm9udCwgeCwgeSwgeik7XHJcbiAgICAgICAgXHJcblx0XHRnbG0udmVjMy5ub3JtYWxpemUodHJhY2tiYWxsLmNhbUZyb250LCB0cmFja2JhbGwubGZyb250KTtcclxuICAgIH1cclxuICAgIGxldCBvdXQgPSBnbG0udmVjMy5jcmVhdGUoKTtcclxuICAgIGdsbS52ZWMzLmFkZChvdXQsdHJhY2tiYWxsLmNhbVBvcyAsdHJhY2tiYWxsLmNhbUZyb250KTtcclxuICAgIGdsbS5tYXQ0Lmxvb2tBdChtYXRyaXgudiwgdHJhY2tiYWxsLmNhbVBvcywgb3V0LCB0cmFja2JhbGwuY2FtVXApO1xyXG59XHJcblxyXG5mdW5jdGlvbiByYWRpYW5zKG51bSl7XHJcbiAgICByZXR1cm4gIG51bSAqIE1hdGguUEkgLyAxODA7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFuaW1hdGUodGltZSkge1xyXG4gICAgaWYgKCFnbG9iYWwuc3RhcnQpIHtcclxuICAgICAgICBnbG9iYWwuc3RhcnQgPSB0aW1lO1xyXG4gICAgfVxyXG4gICAgLy8gaW4gbWlsbGlzZWNvbmRzXHJcbiAgICBsZXQgZGVsdGEgPSB0aW1lIC0gZ2xvYmFsLnN0YXJ0O1xyXG4gICAgZ2xvYmFsLnN0YXJ0ID0gdGltZTtcclxuXHJcbiAgICBzdGF0cy51cGRhdGUoKTtcclxuXHJcbiAgICAvL3RyYWNrYmFsbFxyXG4gICAgaWYoa2V5UHJlc3Mub24gPT09IHRydWUpe1xyXG4gICAgICAgIHRyYWNrYmFsbF91cGRhdGUoJ1RwcmVzcycpO1xyXG4gICAgfVxyXG4gICAgaWYobW91c2UuZG93biA9PT10cnVlKXtcclxuICAgICAgICB0cmFja2JhbGxfdXBkYXRlKCdUbG9vaycpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlcihkZWx0YSwgdGltZSk7XHJcblxyXG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcclxufVxyXG5cclxud2luZG93Lm9ucmVzaXplID0gKCkgPT4ge1xyXG4gICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpO1xyXG5cclxuICAgIGlmIChnbCAmJiBjYW52YXMpIHtcclxuICAgICAgICBjYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG4gICAgICAgIGdsbS5tYXQ0LnBlcnNwZWN0aXZlKG1hdHJpeC5wLCByYWRpYW5zKDYwKSwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoIC8gZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCwgMC4xLCAxMDAwLjApO1xyXG4gICAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIGdsLmRyYXdpbmdCdWZmZXJXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbndpbmRvdy5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICBpbml0V2ViR0woKTtcclxuICAgIGNyZWF0ZVNoYWRlcigpO1xyXG4gICAgbG9hZEFzc2V0KCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgLy8gcmVuZGVyaW5nIGxvb3BcclxuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///43\n')}});